{% extends "app/layout.html" %}
{% block css %}
<style>
    small > i.material-symbols-outlined {
        font-size: inherit;
    }

    .field-wrapper select, .field-wrapper .k-input-inner::placeholder {
        color: rgba(0,0,0,0.4); /* placeholder 더 옅게 */
    }

    .tab_con_box {
        height: 600px;
        display: flex;
        align-content: center;
        justify-content: center;
        flex-direction: column;
        flex-wrap: wrap;
    }
    @media (max-width: 767px) {
        /* tab_con_box sm & 그 이하일 때 높이 수정 */
        .tab_con_box {
            height: 100px;
        }
    }
    
    .chart-box {
        width: 100%;
        height: auto;
        margin: 5px 5px 15px 5px;
        position: relative;
        padding: 20px;
        border-width: 1px;
        border-color: var(--kendo-grid-outline, rgba(0, 0, 0, 0.08));
        border-style: solid;
        min-height: 200px;
        border-radius: 6px;
        /* box-shadow: var(--shadow-card);*/
    }

    /*added by choi : 2025/08/05
                    : 숨기기/보이기 처리 스타일 추가
    */
    .material-symbols-outlined {
        vertical-align: middle;
        line-height: 1; /* 불필요한 여백 제거 */
        font-size: 20px; /* 크기 조정 필요 시 */
    }

</style>
{% endblock %}
{% block content %}
<div class="content-wrap">
    <div class="content-ui-row">
        <form class="search-form" id="searchForm" onsubmit="return false;">
            <div class="card-content search">
                <div class="form-ui">
                    <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
                        <div class="form-item align-h">
                            <label class="k-label k-form-label" for="cboEqu" data-labelCd="설비">설비</label>
                            <div class="field-wrapper">
                                <select id="cboEqu" name="cboEqu" class="form-control"></select>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
                        <div class="form-item align-h">
                            <label class="k-label k-form-label" for="cboModelType" data-labelCd="모델유형">모델유형</label>
                            <div class="field-wrapper">
                                <select id="cboModelType" name="cboModelType" class="form-control"></select>
                            </div>
                        </div>
                    </div>
                    <!--deleted by choi : 2025/08/08 keyword검색을 뺌-->
                    <!--<div class="col-12 col-sm-6 col-lg-4 col-xl-4">
                        <div class="form-item align-h">
                            <label class="k-label k-form-label" for="sch_keyword" data-labelCd="검색어">검색어</label>
                            <div class="field-wrapper">
                                <input id="sch_keyword" name="sch_keyword" class="form-control" />
                            </div>
                        </div>
                    </div>-->
                    <!--added by choi : 2025/08/08 학습된 건만 조회 추가-->
                    <div class="col-12 col-sm-6 col-lg-4 col-xl-4">
                        <div class="form-item align-h">
                            <label class="k-label k-form-label" for="chk_learn">학습된 모델만</label>
                            <input id="chk_learn" name="chk_learn">
                        </div>
                    </div>

                    <div class="col-auto">
                        <div class="card-group-btn search">
                            <button id="btnSearch" class="btn-search">조회</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <div class="content-ui-row connect">
            <div class="card-content grid">
                <div class="card-group-btn">
                    <span class="info-text">
                        <i class="material-symbols-outlined">list_alt</i>
                        <label data-labelCd="모델 목록">모델 목록</label>
                    </span>
                    <span>
                        <!-- 오른쪽 버튼 영역-->
                        <button id="btnExcelMain">Excel</button>
                        <!-- added by choi : 2025/08/05 그리드 숨기기/보이기 버튼 추가-->
                        <button id="btnHideShow">
                            <i class="material-symbols-outlined" id="hideShowIcon">expand_less</i>
                            <span id="hideShowText">접어두기</span>
                        </button>
                    </span>
                </div>
                <div id="model_grid"></div>
            </div>
        </div>
        <div class="content-ui-row connect">
            <div class="card-content edit">
                <div id="tabstrip">
                    <!-- ======================================= tab 리스트 ======================================= -->
                    <ul>
                        <li class="k-active">태그집합생성</li>    <!-- Tab1: 태그집합생성 (기존 작성 내용 그대로) -->
                        <li>데이터</li>
                        <li>변수통계값</li>
                        <li>수치형분포확인</li>
                        <li>범주형분포확인</li>
                        <li>전처리</li>
                        <li>상관관계히트맵</li>
                        <li>XY지정</li>
                        <li>산점도</li>
                        <li>상관관계값조회</li>
                        <li>주성분분석</li>
                        <li>모델생성</li>
                    </ul>
                    <!-- ======================================= 이하 tab 컨텐츠 ======================================= -->
                    <!-- Tab1: 태그집합생성 해당 탭에서만 지정할 스타일이어서 엘리먼트 단계에서 정의 -->
                    <div class="tab-contents" id="model_tag_tab">
                        <!-- tab1 - tag form & grid -->
                        <div class="col-12 col-sm-12 col-md-5">
                        <!--<div class="col-12 col-sm-4 col-md-5">-->
                            <!--<div class="content-ui-column connect">-->
                                <div class="card-content edit">
                                    <div class="card-group-btn">
                                        <span class="info-text">
                                            <i class="material-symbols-outlined">list_alt</i>
                                            <label data-labelCd="태그 목록">태그 목록</label>
                                        </span>
                                        <span>
                                            <!-- 오른쪽 버튼 영역-->
                                            <button id="btnExcelTotal">Excel</button>
                                        </span>
                                    </div>
                                    <div id="total_tag_grid" style="width: inherit"></div>
                                </div>
                            </div>
                        <!--</div>-->
                        <!-- 최종 태그 집합 (Tab1의 오른쪽 영역) -->
                        <!--<div class="col-12 col-sm-12 col-lg-1">-->
                        <div class="col-12 col-sm-12 col-md-1">
                        <!--<div class="col-12 col-sm-1">-->
                            <div class="tab_con_box">
                                <button id="btnAddVar"><i class="material-symbols-outlined">add</i>==&gt;</button>
                            </div>
                        </div>
                        <!--<div class="col-12 col-lg-5">-->
                        <div class="col-12 col-sm-12 col-md-5 col-lg-6">
                        <!--<div class="col-12 col-sm-5 col-md-6">-->
                            <!--<div class="content-ui-column connect">-->
                                <div class="card-content edit">
                                    <div class="card-group-btn">
                                        <span class="info-text">
                                            <i class="material-symbols-outlined">edit_square</i>
                                            <label data-labelCd="입력">입력</label>
                                        </span>
                                        <small id="model_tag_info" class="form-text text-muted" style="display:none;">
                                            <i class="material-symbols-outlined">info</i>
                                            <span>이미 훈련 정보가 생성되어 데이터를 수정/삭제할 수 없습니다.</span>
                                        </small>
                                        <span>
                                            <button id="btnSaveModel"><i class="material-symbols-outlined">save</i>저장</button>
                                            <button id="btnDeleteModel" style="display:none"><i class="material-symbols-outlined">delete</i>삭제</button>
                                        </span>
                                    </div>
                                    <form id="modelTagForm">
                                        <div class="edit-form-ui">
                                            <input type="hidden" id="id" name="id">
                                            <div class="col-12">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label essential" for="Name" data-labelCd="모델명">모델명</label>
                                                    <div class="field-wrapper">
                                                        <input type="text" id="Name" name="Name" data-msg="모델명을" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-6">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label" for="Type" data-labelCd="구분">구분</label>
                                                    <div class="field-wrapper">
                                                        <select type="text" id="Type" name="Type"></select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-6">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label" for="DataVersion" data-labelCd="데이터 버전">데이터 버전</label>
                                                    <div class="field-wrapper">
                                                        <input id="DataVersion" name="DataVersion" />
                                                    </div>
                                                </div>
                                            </div>

                                            <!--<div class="col-12 col-md-8 col-lg-6">-->
                                            <div class="col-12">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label essential" data-labelCd="데이터 수집일시">데이터 수집일시</label>
                                                    <div class="field-wrapper">
                                                        <div id="srchDt">
                                                            <div class="input-group-append">
                                                                <input class="form-control" type="text" id="StartedAt" name="StartedAt" data-msg="데이터 수집 시작 시간을" />
                                                                <span class="input-group-text fs-xl">
                                                                    <i class="fas fa-calendar-alt calendar_color"></i>
                                                                </span>
                                                                <input class="form-control" type="text" id="EndedAt" name="EndedAt" data-msg="데이터 수집 종료 시간을" />
                                                                <span class="input-group-text fs-xl">
                                                                    <i class="fas fa-calendar-alt calendar_color"></i>
                                                                </span>
                                                                <span>
                                                                    <button id="btnGatherTagData" style="margin-left:20px; display:none;">
                                                                        <i class="material-symbols-outlined">play_arrow</i>수집
                                                                    </button>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label" for="Description" data-labelCd="비고">비고</label>
                                                    <div class="field-wrapper">
                                                        <textarea id="Description" name="Description"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    <!-- tag_col에 저장될 데이터 -->
                                    <div class="card-group-btn k-mt-5">
                                        <span class="info-text">
                                            <i class="material-symbols-outlined">list_alt</i>
                                            <label data-labelCd="최종 태그 집합">최종 태그 집합</label>
                                        </span>
                                        <span>
                                            <button id="btnAddUserVar">사용자 변수 추가</button>
                                            <button id="btnDelVar">삭제</button>
                                        </span>
                                    </div>
                                    <div id="model_tag_grid" style="width:inherit"></div>
                                </div>
                            </div>
                        <!--</div>-->
                    </div>
                    <!-- Tab2: 데이터 -->
                    <div class="tab-contents">
                        <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="데이터 상세정보">데이터 상세정보</label>
                            </span>
                            <span>
                                <!-- 25.08.20 김하늘 - 엑셀 다운로드 버튼 추가 -->
                                <button id="btnExcelDetail" style="display:none">Excel</button>
                                <button id="btnNewData" style="display:none">csv등록</button>
                                <button id="btnEditData" style="display:none">수정</button>
                                <button id="btnDeleteData" style="display:none"><i class="material-symbols-outlined">delete</i>삭제</button>
                            </span>
                        </div>
                        <div id="data_detail_grid"></div>
                    </div>

                    <!-- Tab3: 변수통계값 -->
                    <div class="tab-contents">
                        <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="변수통계값">변수통계값</label>
                            </span>
                            <span>
                                <!-- 25.08.20 김하늘 - 엑셀 다운로드 버튼 추가 -->
                                <button id="btnExcelStat" style="display:none">Excel</button>
                            </span>
                        </div>
                        <div id="ds_col_grid"></div>
                    </div>

                    <!-- Tab4: 수치형분포확인 -->
                    <div class="tab-contents">
                        <!-- <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="수치형분포확인">수치형분포확인</label>
                            </span>
                        </div> -->
                        <div class="col-auto">
                            <p>
                                * 수치형 데이터의 값별 분포 수를 보여 줍니다.
                                변수 개수, 또는 데이터 개수가 많은 경우 시간이 오래 걸릴 수 있습니다.
                            </p>
                        </div>
                        <div style="text-align:center;">
                            <a><img id="num_dist_chart" style="max-width:90%; max-height: 1000px" /></a>
                        </div>
                    </div>

                    <!-- Tab5: 범주형분포확인 -->
                    <div class="tab-contents">
                        <!-- <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="범주형분포확인">범주형분포확인</label>
                            </span>
                        </div> -->
                        <form class="search-form k-mt-3" id="cateVarForm">
                            <div class="card-content search">
                                <div class="form-ui">
                                    <div class="col-12 col-md-6 col-lg-4">
                                        <div class="form-item align-h">
                                            <label class="k-label k-form-label" for="cate_vari" data-labelCd="범주형변수">범주형변수</label>
                                            <div class="field-wrapper">
                                                <select id="cate_vari" name="cate_vari" class="k-picker k-dropdownlist k-picker-solid k-picker-md k-rounded-md k-valid"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="card-group-btn search">
                                            <button class="btn-search" id="btnCatDistChart">조회</button>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <p style="margin:0;">
                                            * 범주형 변수를 선택한 후 조회 버튼을 클릭하면 데이터의 값별 분포 수를 보여 줍니다.
                                            변수 개수, 또는 데이터 개수가 많은 경우 시간이 오래 걸릴 수 있습니다.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div style="text-align:center;">
                            <a><img id="cat_dist_chart" style="max-width:90%; max-height: 600px" /></a>
                        </div>
                    </div>

                    <!-- Tab6: 전처리 -->
                    <div class="tab-contents">
                        <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="전처리">전처리</label>
                            </span>
                            <span>
                                <!-- 25.08.20 김하늘 - 엑셀 다운로드 버튼 추가 -->
                                <button id="btnExcelPreprocess" style="display:none">Excel</button>
                                <button id="btnSavePreprocess"><i class="material-symbols-outlined">delete</i>결측치/이상치 제거</button>
                            </span>
                        </div>
                        <div id="ds_col_grid2"></div>
                    </div>

                    <!-- Tab7: 상관관계히트맵 -->
                    <div class="tab-contents">
                        <!-- <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="상관관계히트맵">상관관계히트맵</label>
                            </span>
                        </div> -->
                        <div class="col-auto">
                            <p style="margin: 0px;">
                                * 수치형 데이터 간 상관관계를 히트맵 형태로 표시합니다.
                            </p>
                            <p style="color: rgb(99, 110, 250);">
                                * 변수의 모든 데이터 값이 동일한 경우 상관계수를 구할 수 없습니다.(색상과 수치값이 나타나지 않음)
                            </p>
                        </div>
                        <div style="text-align:center;">
                            <a><img id="heatmap_chart" style="max-width:90%; max-height: 600px;" /></a>
                        </div>
                    </div>

                    <!-- Tab8: XY 지정 -->
                    <div class="tab-contents">
                        <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="XY 지정">XY 지정</label>
                            </span>
                            <span>
                                <!-- 25.08.20 김하늘 - 엑셀 다운로드 버튼 추가 -->
                                <button id="btnExcelXY" style="display:none">Excel</button>
                                <button id="btnSaveXY"><i class="material-symbols-outlined">save</i>저장</button>
                            </span>
                        </div>
                        <div id="settingXy_grid"></div>
                    </div>

                    <!-- Tab9: 산점도 -->
                    <div class="tab-contents">
                        <!-- <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="산점도">산점도</label>
                            </span>
                        </div> -->
                        <div class="col-auto">
                            <p>
                                * X변수와 Y변수에 대해서 산점도를 그려 표시합니다.
                                변수 개수, 또는 데이터 개수가 많은 경우 시간이 오래 걸릴 수 있습니다.<br />
                                <!--* X변수와 Y변수를 지정한 경우는 해당 상관관계만, 지정하지 않은 경우는 전체 변수 간의 상관관계를 표시합니다.-->
                            </p>
                        </div>
                        <div style="text-align:center;">
                            <a><img id="scatter_chart" style="max-width:90%; max-height: 600px" /></a>
                        </div>
                    </div>

                    <!-- Tab10: 상관관계값조회 -->
                    <div class="tab-contents">
                        <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="상관관계값조회">상관관계값조회</label>
                            </span>
                            <span>
                                <!-- 25.08.20 김하늘 - 엑셀 다운로드 버튼 추가 -->
                                <button id="btnExcelCorr" style="display:none">Excel</button>
                            </span>
                        </div>
                        <div id="corr_grid"></div>
                    </div>

                    <!-- Tab11: 주성분분석 (PCA와 동일) -->
                    <div class="tab-contents">
                        <!-- <div class="card-group-btn">
                            <span class="info-text">
                                <i class="material-symbols-outlined">edit_square</i>
                                <label data-labelCd="주성분분석">주성분분석</label>
                            </span>
                        </div> -->
                        <form class="search-form" id="pcaForm">
                            <div class="card-content search">
                                <div class="form-ui">
                                    <div class="col-12 col-md-6 col-lg-4">
                                        <div class="form-item align-h">
                                            <label class="k-label k-form-label" for="pca_num_dim" data-labelCd="PCA차원(주성분 수)">PCA차원(주성분 수)</label>
                                            <div class="field-wrapper">
                                                <select id="pca_num_dim" name="pca_num_dim" class="k-picker k-dropdownlist k-picker-solid k-picker-md k-rounded-md k-valid"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="card-group-btn search">
                                            <button class="btn-search" id="btnPcaApply">실행</button>
                                        </div>
                                    </div>
                                    <div class="content-ui-row connect">
                                        <div class="col-auto">
                                            <p style="margin: 0px;">
                                                * PCA(차원축소)는 고차원 데이터의 차원을 축소하여 데이터의 주요 특징을 파악하고 시각화 및 분석을 용이하게 만드는 기법입니다.<br />
                                                * 차원수를 지정하지 않고 실행할 경우, 설명률이 90% 이상이 되는 차원으로 자동 지정됩니다.
                                            </p>
                                            <!-- <p style="color: #40c0f1; margin: 0px;">* PCA 실행 결과 차트는 3차원(3D)까지만 지원됩니다.</p> -->
                                            <p style="color: rgb(99, 110, 250); margin: 0px;">* PCA 실행 결과 차트는 3차원(3D)까지만 지원됩니다.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div id="pca_chart">
                            <div id="pca_plotly" style="width: 80%; margin: auto; position: relative;"></div>
                            <div id="pca_result" style="width: 80%; margin: auto; position: relative;"></div>
                        </div>
                    </div>

                    <!-- Tab12: 모델생성 -->
                    <div class="tab-contents">
                        <!-- ▶ 리모컨 설정 영역 (왼쪽) -->
                        <div class="content-ui-row connect" style="align-items: stretch;">
                            <div class="col-12 col-md-4">
                                <div class="card-content edit">
                                    <div class="card-group-btn">
                                        <span class="info-text">
                                            <i class="material-symbols-outlined">tune</i>
                                            <label data-labelCd="모델 설정">모델 설정</label>
                                        </span>
                                        <!--<span>
                                        <button id="btnResetTrain"><i class="material-symbols-outlined">refresh</i>초기화</button>
                                        <button id="btnSaveTrain"><i class="material-symbols-outlined">save</i>저장</button>-->
                                        <!--<button id="btnTrainStart"><i class="material-symbols-outlined">play_arrow</i>학습</button>-->
                                        <!--</span>-->
                                    </div>
                                    <div class="col-auto" id="noDataMsg" style="display:none">
                                        <p>
                                            * 먼저 데이터 탭에서 학습 데이터를 등록해 주세요.
                                        </p>
                                    </div>
                                    <form id="modelTrainForm">
                                        <div class="edit-form-ui">
                                            <input id="id" name="id" type="hidden" />

                                            <div class="col-12" id="TrainStatusWrap" style="display:none;">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label" for="TrainStatus" data-labelCd="학습상태">학습상태</label>
                                                    <div class="field-wrapper">
                                                        <input id="TrainStatus" name="TrainStatus" type="hidden" />
                                                        <!--<input id="status_name" name="status_name" class="form-control" />-->
                                                        <span class="info-text">
                                                            <!-- 여기에 JS로 아이콘 + 텍스트 조합 삽입 -->
                                                            <span id="statusDisplay"></span>
                                                            <button id="btnTrainStart" type="button" class="k-button">
                                                                <i class="material-symbols-outlined">play_arrow</i>학습
                                                            </button>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-12" id="ApplyYNWrap" style="display:none;">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label" for="ApplyYN" data-labelCd="시스템적용 여부">시스템적용 여부</label>
                                                    <div class="field-wrapper">
                                                        <input id="ApplyYN" name="ApplyYN" />
                                                        <!--<input id="ApplyYN" name="ApplyYN" class="form-control" />-->
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-12">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label essential" for="TaskType" data-labelCd="분석유형">분석유형</label>
                                                    <div class="field-wrapper" style="flex-wrap: wrap;">
                                                        <select id="TaskType" name="TaskType" class="form-control" data-msg="분석유형을"></select>
                                                        <small id="taskHint" class="form-text text-muted" style="display:none;">
                                                            <i class="material-symbols-outlined">info</i>
                                                            <span></span>
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-12">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label essential" for="AlgorithmType" data-labelCd="알고리즘">알고리즘</label>
                                                    <div class="field-wrapper">
                                                        <select id="AlgorithmType" name="AlgorithmType" class="form-control" data-msg="알고리즘을"></select>
                                                        <small id="algoInfo" class="form-text text-muted" style="display:none;">
                                                            <i class="material-symbols-outlined">info</i>
                                                            <span></span>
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 동적 하이퍼파라미터 폼 들어갈 자리 -->
                                            <!-- 우선 제이슨으로 받고 나중에 동적 폼으로 변경 -->
                                            <div class="col-12" id="hyperParamWrap" style="display: none;">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label" for="hyperParam" data-labelCd="하이퍼파라미터 설정">하이퍼파라미터 설정</label>
                                                    <div class="field-wrapper">
                                                        <div id="hyperParam" name="hyperParam" style="width: 100%;"></div>
                                                        <!--<div id="hyperParam" name="hyperParam" class="k-rounded-md k-input-solid"></div>-->
                                                        <!--<textarea id="hyperParam" name="hyperParam" class="form-control"></textarea>-->
                                                        <!--<div id="hyperParam" name="hyperParam" class="form-control"></div>-->
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-12">
                                                <div class="form-item align-h">
                                                    <label class="k-label k-form-label" for="train_desc" data-labelCd="비고">비고</label>
                                                    <div class="field-wrapper">
                                                        <textarea id="train_desc" name="train_desc"></textarea>
                                                        <!--<textarea id="hyperParam" name="hyperParam" class="form-control"></textarea>-->
                                                        <!--<div id="hyperParam" name="hyperParam" class="form-control"></div>-->
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </form>
                                    <!-- 실행 버튼. col-xx를 주어야 form이랑 동일한 margin 적용 가능 -->
                                    <div class="col-12">
                                        <div class="card-group-btn k-mt-3" id="trainBtnWrap">
                                            <span></span>
                                            <span>
                                                <button id="btnResetTrain"><i class="material-symbols-outlined">refresh</i>초기화</button>
                                                <button id="btnSaveTrain">
                                                    <i class="material-symbols-outlined">save</i>
                                                    <span class="btn-label">저장</span>
                                                </button>
                                                <button id="btnDeleteTrain" style="display:none"><i class="material-symbols-outlined">delete</i>삭제</button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 결과 화면 영역 (오른쪽) -->
                            <div class="col-12 col-md-8">
                                <div class="card-content edit" style="height:100%;" id="model_result">
                                    <!-- row1 -->
                                    <div class="col-12">
                                        <!-- 상단 제목 및 버튼 -->
                                        <div class="card-group-btn">
                                            <span class="info-text">
                                                <i class="material-symbols-outlined">insights</i>
                                                <label data-labelCd="검증 결과 그래프">검증 결과 그래프</label>
                                            </span>
                                        </div>
                                        <!--모델 예측 그래프-->
                                        <div class="form-item align-h chart-box">
                                            <div class="field-wrapper">
                                                <div id="model_pred_chart" style="width: 100%; margin: 10px 10px 0px 10px; position: relative; "></div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- row2 -->
                                    <div class="col-12">
                                        <!-- 상단 제목 및 버튼 -->
                                        <div class="card-group-btn">
                                            <span class="info-text">
                                                <i class="material-symbols-outlined">bar_chart</i>
                                                <label data-labelCd="변수 중요도 그래프">변수 중요도 그래프</label>
                                            </span>
                                        </div>
                                        <!-- tree & 변수중요도 시각화 차트-->
                                        <div class="form-item align-h chart-box">
                                            <div class="field-wrapper">
                                                <a><img id="model_tree_chart" style="width:100%" /></a>
                                                <a><img id="model_feat_chart" style="width:100%" /></a>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- row3 -->
                                    <div class="col-12">
                                        <!-- 상단 제목 및 버튼 -->
                                        <div class="card-group-btn">
                                            <span class="info-text">
                                                <i class="material-symbols-outlined">monitoring</i>
                                                <label data-labelCd="모델 성능 지표">모델 성능 지표</label>
                                            </span>
                                            <span>
                                                <!-- 25.08.20 김하늘 - 엑셀 다운로드 버튼 추가 -->
                                                <button id="btnExcelMetric" style="display:none">Excel</button>
                                            </span>
                                        </div>
                                        <div class="form-item align-h chart-box">
                                            <div class="field-wrapper">
                                                <!-- 모델성능지표 grid & ROC 커브 차트-->
                                                <div id="model_score_grid" style="width: auto"></div> <!-- Accuracy, F1-score 등 -->
                                                <!-- <div id="model_score_grid" style="display: none; width: auto"></div> --> <!-- Accuracy, F1-score 등 -->
                                                <a><img id="train_score_chart" style="width:100%" /></a>
                                                <a><img id="test_score_chart" style="width:100%" /></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% verbatim %}
{% endverbatim %}
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    class DataSciencePage {
        constructor() {
            this.baseUrl = '/api/ai/learning_data';
            this.modelGrid = null;
            this.totalTagGrid = null;
            this.modelTagGrid = null;
            this.mm_id = null; // model master_id
            this.md_id = null; // model_id
            this.equ_id = null; // equip_id
            this.mt_id = null; // model train_id

            // FileUploadPage 인스턴스를 전역으로 선언
            window.fileUploaderInstance = null;

            // mission_proc_options를 선언 (옵션 배열)
            this.mission_proc_options = [
                { code: '', name: '-' },
                { code: 'drop', name: '제거' },
                { code: 'mean', name: '평균' },
                { code: 'median', name: '중간값' },
                { code: 'mode', name: '최빈값' }
            ];
            // mission_option_dc도 생성 (코드별 이름 매핑)
            this.mission_option_dc = {};
            this.mission_proc_options.forEach(item => {
                this.mission_option_dc[item.code] = item.name;
            });

            this.init();
        }

        init() {
            this.initUIComponents();
            this.initGrids();
            this.initTabStrip();
        }

        initUIComponents() {
            let _this = this;

            // 메인데이터 model search form
            AjaxUtil.fillDropDownOptions($('#cboEqu'), 'equipment', 'all', null)
            AjaxUtil.fillDropDownOptions($('#cboModelType'), 'user_code', 'all', null, 'MODEL_TYPE')
            $('#sch_keyword').kendoTextBox({ placeholder: '모델명, 유형, 설명' });
            kendoUtil.bindEnterKey('#sch_keyword', () => this.searchMainData());

            kendoUtil.bindButton('#btnSearch', 'search', 'info', () => this.searchMainData());
            kendoUtil.bindButton('#btnExcelMain', 'file-excel', 'success', () => {
                kendoUtil.saveAsExcel('#model_grid', "모델 목록");
            });

            //added by choi : 2025/08/05
            //              : 그리드 숨기기/보이기 처리 스타일 추가
            $('#btnHideShow').kendoButton({
                themeColor: "base",
                click: function () {
                    //const grid = $('#model_grid');
                    //const $icon = $('#hideShowIcon');
                    //const $text = $('#hideShowText');

                    //if (grid.is(':visible')) {
                    //    grid.hide();
                    //    $icon.text('expand_more');
                    //    $text.text('펼치기');
                    //} else {
                    //    grid.show();
                    //    $icon.text('expand_less');
                    //    $text.text('접어두기');
                    //}

                    // 김하늘 수정(25.08.08) - 그리드 숨기기 처리에 따른 그리드 높이 조정
                    const modelGrid = $('#model_grid'); // 상단 그리드
                    const activeTabIndex = $("#tabstrip").data("kendoTabStrip").select().index(); // 현재 활성화된 탭 인덱스
                    const bottomGridElement = $(`#tabstrip .tab-contents:eq(${activeTabIndex})`).find('.k-grid'); // 하단 활성화된 그리드
                    const bottomGrid = bottomGridElement.data("kendoGrid"); // Kendo Grid 인스턴스
                    const $icon = $('#hideShowIcon');
                    const $text = $('#hideShowText');

                    if (modelGrid.is(':visible')) {
                        modelGrid.hide(); // 상단 그리드 숨기기
                        $icon.text('expand_more');
                        $text.text('펼치기');

                        // 첫 번째/마지막 탭이 아닌 경우에만 하단 그리드 높이 확장
                        if ((activeTabIndex != 0 && activeTabIndex != 11) && bottomGrid) {
                            bottomGrid.setOptions({ height: 600 }); // 실제 그리드 높이 확장
                        }
                    } else {
                        modelGrid.show(); // 상단 그리드 보이기
                        $icon.text('expand_less');
                        $text.text('접어두기');

                        // 첫 번째 탭이 아닌 경우에만 하단 그리드 높이 기본값으로 설정
                        if (activeTabIndex !== 0 && bottomGrid) {
                            bottomGrid.setOptions({ height: 350 }); // 실제 그리드 높이 기본값으로 설정
                        }
                    }
                }
            });

            //added by choi : 2025/08/08
            $('#chk_learn').kendoSwitch({
                checked: false
            });


            // tab1 ====================================================================

            // tab1 - btn
            // 태그목록 excel 다운로드
            kendoUtil.bindButton('#btnExcelTotal', 'file-excel', 'success', () => {
                kendoUtil.saveAsExcel('#total_tag_grid', "전체 태그 목록");
            });

            // 변수목록 -> 최종태그집합 add
            $('#btnAddVar').kendoButton({
                click: function () {
                    _this.addVar();
                }
            });

            // 변수목록 -> 사용자 정의 변수 추가
            $('#btnAddUserVar').kendoButton({
                themeColor: "success",
                click: function () {
                    let userVar = true;
                    _this.addVar(userVar);
                }
            });

            // 변수 삭제
            kendoUtil.bindButton('#btnDelVar', null, 'error', () => {
                _this.deleteVar();
            });


            // 모델 저장
            kendoUtil.bindButton('#btnSaveModel', null, 'info', () => {
                if (!_this.mm_id) {
                    // 선택된 마스터가 없는 경우
                    Alert.alert('error', '상단 목록에서 모델을 생성할 마스터를 선택해 주세요.');
                    return;
                }

                let updateYN = _this.md_id ? '수정' : '저장';

                Alert.confirm('', `모델 정보 및 태그집합 정보를 ${updateYN}하시겠습니까?`, () => {
                    //_this.saveModelwithTag();

                    let withTag = null;
                    let tagItem = _this.modelTagGrid.getData();

                    if (tagItem.length > 0) {
                        withTag = true;
                    } else {
                        withTag = null;
                    }

                    console.log("withTag플래그", withTag);

                    _this.saveModel(withTag);
                });

            });

            // 모델 삭제
            kendoUtil.bindButton('#btnDeleteModel', null, 'error', () => {
                if (!_this.md_id) {
                    Alert.alert('error', '모델이 선택되지 않았습니다. 상단 목록에서 삭제할 모델을 선택해 주세요.');
                    return;
                }

                Alert.confirm("delete", "삭제하시겠습니까?", function () {
                    _this.deleteModel();
                });
            });
            // 데이터 수집 버튼
            kendoUtil.bindButton('#btnGatherTagData', null, 'success', () => {
                // 데이터 통합 로직
                _this.gatherTagData();
            });


            // tab1 - form
            $('#Name').kendoTextBox();
            AjaxUtil.fillDropDownOptions($('#Type'), 'user_code', 'all', null, 'TAGDATA_TYPE')
            //$('#Type').kendoTextBox(/*{ enable: false }*/);
            $('#DataVersion').kendoTextBox(/*{ enable: false }*/);
            $('#Description').kendoTextArea({
                rows: 3,
                maxLength: 200,
                placeholder: ""
            });

            $("#StartedAt").kendoDateTimePicker({
                format: "yyyy-MM-dd HH:mm",
                timeFormat: "HH:mm", // format과 별도로 설정 필요
                max: new Date(), // 선택 가능 날짜를 현재 시각까지만 허용
                value: new Date(new Date().setDate(new Date().getDate() - 7)),
                open: function (e) {
                    this.max(new Date()); // 랜더링 이후 max 시간 초기화
                }
            })
            //}).closest(".k-datepicker").css("width", "140px");

            $("#EndedAt").kendoDateTimePicker({
                format: "yyyy-MM-dd HH:mm",
                timeFormat: "HH:mm",
                max: new Date(),
                value: new Date(),
                open: function (e) {
                    this.max(new Date()); // 랜더링 이후 max 시간 초기화
                }
            })
            //}).closest(".k-datepicker").css("width", "140px");


            // tab2 ====================================================================

            // csv기반 모델 등록 버튼
            kendoUtil.bindButton('#btnNewData', 'k-i-save', 'info', () => {
                //kendoUtil.bindButton('#btnNewData', 'file-excel', 'success', () => {

                if (!_this.mm_id) {
                    Alert.alert('info', '목록에서 데이터를 업로드 할 모델마스터를 선택해 주세요.');
                    return;
                }

                if (_this.md_id) {
                    Alert.confirm("info",
                        "이미 등록된 파일이 존재합니다. 수정하시겠습니까?",
                        function () {
                            let data = _this.getDsInfo();
                            _this.openDataUploadPopup(data);
                        },
                    );
                } else {
                    // csv 데이터 업로드 = 모델 생성으로 고정
                    _this.openDataUploadPopup();
                }
            });

            // tab2 모델 수정 버튼
            kendoUtil.bindButton('#btnEditData', 'k-i-save', 'info', () => {
                if (!_this.md_id) {
                    Alert.alert('error', '목록에서 데이터를 수정할 모델을 선택해 주세요.');
                    return;
                }

                // 기생성된 모델 정보(data)를 popup에게 전달
                const data = _this.getDsInfo();
                _this.openDataUploadPopup(data);
            });

            // tab2 모델 삭제 버튼
            kendoUtil.bindButton('#btnDeleteData', null, 'error', () => {
                if (!_this.md_id) {
                    Alert.alert('error', '목록에서 삭제할 모델을 선택해 주세요.');
                    return;
                }

                Alert.confirm("delete", "삭제하시겠습니까?", function () {
                    _this.deleteModel();
                });
            });

            // tab2 데이터 상세 excel 다운로드
            kendoUtil.bindButton('#btnExcelDetail', 'file-excel', 'success', () => {
                if (!_this.md_id) {
                    Alert.alert('error', '상단 목록에서 모델을 선택해 주세요.');
                    return;
                }

                kendoUtil.saveAsExcel('#data_detail_grid', "모델 상세 데이터");
            });

            // tab3 ====================================================================
            // 변수통계값 excel 다운로드
            kendoUtil.bindButton('#btnExcelStat', 'file-excel', 'success', () => {
                if (!_this.md_id) {
                    Alert.alert('error', '상단 목록에서 모델을 선택해 주세요.');
                    return;
                }

                kendoUtil.saveAsExcel('#ds_col_grid', "변수통계 데이터");
            });

            // tab5 ====================================================================
            // 범주형 변수 리스트
            $('#cate_vari').kendoMultiSelect({
                dataSource: [], //
                //dataSource: _this.fillCategoryVars(),
                dataTextField: "text",
                dataValueField: "value",
                placeholder: "선택하세요",
                filter: "contains",
                downArrow: true,
                clearButton: true,
                noDataTemplate: "No Data",
                change: function (e) {
                    console.log("선택 변경됨", this.value());
                },
                value: []
            });

            // 범주형 분석 조회 버튼
            kendoUtil.bindButton('#btnCatDistChart', "search", 'base', () => {
                let items = $("#cate_vari").data("kendoMultiSelect").value() || [];

                // 값이 단일 문자열일 경우 배열로 변환
                if (!Array.isArray(items)) {
                    items = [items];
                }
                console.log("items", items);

                let values = '';

                if (items.length > 0) {
                    items.forEach(function (value, index) {
                        if (index == 0)
                            values = value;
                        else
                            values += ',' + value;
                    });
                    console.log("value", values);
                    _this.loadChartImage("cat_dist_chart", "ds_col_count_plot", { variables: values });
                } else {
                    Alert.alert("info", "범주형 변수를 선택해주세요.");
                }
            });

            // tab6 ====================================================================
            // 전처리 excel 다운로드
            kendoUtil.bindButton('#btnExcelPreprocess', 'file-excel', 'success', () => {
                if (!_this.md_id) {
                    Alert.alert('error', '상단 목록에서 모델을 선택해 주세요.');
                    return;
                }
 
                kendoUtil.saveAsExcel('#ds_col_grid2', "전처리 데이터");
            });

            // 전처리 저장 버튼
            kendoUtil.bindButton('#btnSavePreprocess', null, 'error', () => {
                Alert.confirm('', '결측치 및 이상치를 제거하시겠습니까?', () => {
                    _this.saveDsCol();
                });
            });

            // tab8 ====================================================================
            // x,y 지정 excel 다운로드
            kendoUtil.bindButton('#btnExcelXY', 'file-excel', 'success', () => {
                if (!_this.md_id) {
                    Alert.alert('error', '상단 목록에서 모델을 선택해 주세요.');
                    return;
                }

                kendoUtil.saveAsExcel('#settingXy_grid', "XY 데이터");
            });

            // x,y 지정 저장 버튼
            kendoUtil.bindButton('#btnSaveXY', null, 'info', () => {
                Alert.confirm('', '지정한 X, Y변수를 저장하시겠습니까??', () => {
                    _this.saveDsColXY();
                });
            });

            // tab10 ====================================================================
            // 상관관계값 excel 다운로드
            kendoUtil.bindButton('#btnExcelCorr', 'file-excel', 'success', () => {
                if (!_this.md_id) {
                    Alert.alert('error', '상단 목록에서 모델을 선택해 주세요.');
                    return;
                }

                kendoUtil.saveAsExcel('#corr_grid', "상관관계값 데이터");
            });

            // tab11 ====================================================================
            // PCA 차원축소 가능 범위 드롭다운
            $('#pca_num_dim').kendoDropDownList({
                dataSource: [],
                dataTextField: "text",
                dataValueField: "value",
                //placeholder: "선택하세요",
                optionLabel: {
                    text: "선택하세요",
                    value: ""
                },
                noDataTemplate: "No Data",
                change: function (e) {
                    console.log("선택 변경됨", this.value());
                },
                value: []
            });

            // pca 실행 버튼
            kendoUtil.bindButton('#btnPcaApply', null, 'base', () => {
                let dropdown = $("#pca_num_dim").data("kendoDropDownList");

                if (dropdown) {
                    let selected_value = dropdown.value();

                    let num_components = selected_value || null;
                    console.log("num_components", num_components);

                    _this.loadChartImage("pca_result", "pca_apply", { num_components: num_components });
                }
            });

            // tab12 ====================================================================
            // form 초기화
            AjaxUtil.fillDropDownOptions($('#TaskType'), 'user_code', 'choose', null, 'TASK_TYPE');
            AjaxUtil.fillDropDownOptions($('#AlgorithmType'), 'user_code', 'choose', null, 'ALGORITHM_TYPE');
            //AjaxUtil.fillDropDownOptions($('#TrainStatus'), 'user_code', 'choose', null, 'TRAINING_STATUS');
            $('#status_name').kendoTextBox({ enable: false });
            $('#ApplyYN').kendoSwitch({
                checked: false
            });
            //$('#hyperParam').kendoTextArea({
            //    rows: 10,
            //    maxLength: 200,
            //    placeholder: ""
            //});
            $('#train_desc').kendoTextArea({
                rows: 4,
                maxLength: 200,
                placeholder: ""
            });

            // 선택한 알고리즘과 매핑된 분석유형 저장용
            let currentAlgoMappedTasks = [];

            // 분석유형
            const taskTypeDropdown = $('#TaskType').data('kendoDropDownList');
            const taskTypeData = taskTypeDropdown.dataSource.data();

            $('#TaskType').change(function () {
                const taskType = this.value;
                console.log("taskType value", taskType);
                const groupCode = taskType ? `AI_${taskType}` : 'ALGORITHM_TYPE';
                const selectedAlgo = $('#AlgorithmType').data('kendoDropDownList').value();
                const taskHint = $('#taskHint');

                // 알고리즘이 선택되어 있고, 현재 선택한 task와 매칭되지 않을 때
                if (selectedAlgo && taskType && !currentAlgoMappedTasks.includes(taskType)) {
                    const taskNames = currentAlgoMappedTasks
                        .map(code => {
                            const match = taskTypeData.find(row => row.value === code || row.code === code);
                            return match ? match.text : code;
                        })
                        .join(', ');

                    Alert.confirm('info',
                        '해당 분석유형에 현재 선택되어 있는 알고리즘을 적용할 수 없습니다.' +
                        '확인 버튼을 누르시면 선택하신 알고리즘 정보가 초기화됩니다.',
                        () => {
                            // 확인 -> 알고리즘 리셋(리셋이므로 seleted = null)
                            AjaxUtil.fillDropDownOptions($('#AlgorithmType'), 'user_code', 'choose', null, groupCode);
                            //AjaxUtil.fillDropDownOptions($('#AlgorithmType'), 'user_code', 'choose', selectedAlgo, groupCode);
                            //$('#AlgorithmType').data('kendoDropDownList').value('');
                            $('#AlgorithmType').trigger('change');
                        },
                        () => {
                            // 취소 시 -> 알고리즘에 맞는 추천유형 보여주기(현재 선택된 분석유형이 알고리즘과 맞지 않음!)
                            taskHint.show().find('span').text(`추천 분석유형: ${taskNames}`);
                        }
                    );
                    return; // Alert 후 나머지 실행 막기
                }

                AjaxUtil.fillDropDownOptions($('#AlgorithmType'), 'user_code', 'choose', selectedAlgo, groupCode);
                $('#AlgorithmType').trigger('change');

            });

            let previousAlgoValue = null;

            $('#AlgorithmType').off('change').on('change', function (e) {
                console.log("바인드 때도 인식되나 테스트");
                //$('#AlgorithmType').change(function (e) {
                const algo = this.value;
                console.log('change 발생!', {
                    time: new Date().toISOString(),
                    value: algo,
                    triggeredBy: e.originalEvent ? '사용자 또는 trigger' : '스크립트 내부'
                });

                // 외부 원인 change 호출 방지
                // algo가 유효한 값일 때만 이전 값과 비교하여 중복 억제
                if (algo != '' && algo == previousAlgoValue) {
                    console.log('[중복 억제] same value, skipping...');
                    return;
                }

                previousAlgoValue = algo;

                const selectedTask = $('#TaskType').data('kendoDropDownList').value();
                const algoList = $('#AlgorithmType').data('kendoDropDownList').dataSource.data();
                const taskHint = $('#taskHint');
                const algoInfo = $('#algoInfo');

                // algoInfo & taskHint 초기화
                algoInfo.hide().find('span').text('');
                taskHint.hide().find('span').text('');

                console.log("algoList", algoList);

                if (selectedTask) {
                    if (algoList.length <= 1) {
                        // 선택된 분석유형이 있지만, 알고리즘이 1개 이하일 때(기본 1개. text:선택, value:'')
                        algoInfo.show().find('span').text('해당 분석 유형에 적합한 알고리즘이 없습니다.');
                        //algoInfo.show();

                        return;
                    }
                    // 리턴을 여기서 안하는 이유는 selectedTask가 있어도 아래를 타야할 때가 있어서
                }

                if (!algo) return;

                // 하이퍼파라미터 폼 렌더링
                _this.renderHyperParamForm(algo);

                const rows = AjaxUtil.getSelectData('user_code', null, algo);
                const taskTypes = [...new Set(
                    rows.filter(r => r.group?.startsWith('AI_'))
                        .map(r => r.group.replace('AI_', ''))
                )];

                currentAlgoMappedTasks = taskTypes; // 현재 알고리즘과 매핑된 분석유형 리스트 저장

                if (!taskTypes.length) {
                    taskHint.show().find('span').text('해당 알고리즘은 분석 유형과 매핑되어 있지 않습니다.');
                } else {
                    const taskNames = taskTypes
                        .map(code => {
                            const match = taskTypeData.find(row => row.value === code || row.code === code);
                            return match ? match.text : code;
                        })
                        .join(', ');

                    console.log(`selectedTask: ${selectedTask} \ntaskTypes: ${taskTypes}`);
                    if (taskTypes.length == 1 && taskTypes[0] == selectedTask) {
                        // 이미 선택된 task가 있고, 추천유형(1개)과 일치하는 경우
                        taskHint.hide().find('span').text('');
                    } else {
                        // 선택된 task가 없거나 추천 유형이 2개 이상인 경우
                        taskHint.show().find('span').text(`추천 분석유형: ${taskNames}`);
                    }
                }
            });

            // 버튼
            kendoUtil.bindButton('#btnResetTrain', null, 'base', () => {
                // 사용자가 선택한 분석유형에 따른 알고리즘이 바인딩 되어있는 상태이므로 초기화 필요
                AjaxUtil.fillDropDownOptions($('#AlgorithmType'), 'user_code', 'choose', null, 'ALGORITHM_TYPE');
                if (_this.mt_id) {
                    const formData = _this.getTrainInfo();
                    _this.initTrainForm(formData);  // 기존 정보 → new_check 필요 없음
                } else {
                    _this.initTrainForm();
                }
            });

            kendoUtil.bindButton('#btnSaveTrain', null, 'info', () => {
                if (!_this.md_id) {
                    Alert.alert('info', "학습 정보를 생성할 모델, 또는 수정할 학습 정보를 선택해주세요.");
                    return;
                }

                // 학습 상태 확인
                let train_status = $('#TrainStatus').val();
                console.log("train_status", train_status);

                // 저장이 완료된 학습 정보는 train_status가 INITIALIZED 또는 FAILED일 때만 수정 가능하게
                // train_status가 PENDING, TRAINING, COMPLETED인 경우는 수정 불가
                if (train_status && !(train_status == 'INITIALIZED' || train_status == 'FAILED')) {
                    Alert.confirm('', `해당 학습정보로 이미 훈련이 시작/완료되어 정보를 수정할 수 없습니다. 새로운 학습정보를 생성하시겠습니까?`, () => {
                        _this.saveTrainConfig();
                    });
                    return;
                }

                // mt_id가 있는 경우 수정, 없는 경우 저장
                const btn_action = _this.mt_id ? '수정' : '저장';

                Alert.confirm('', `모델 학습 정보를 ${btn_action}하시겠습니까?`, () => {
                    _this.saveTrainConfig();
                });
            });

            kendoUtil.bindButton('#btnDeleteTrain', null, 'error', () => {
                if (_this.mt_id) {
                    // 학습 상태 확인
                    let train_status = $('#TrainStatus').val();
                    let apply_yn = $('#ApplyYN').val();

                    if (train_status == 'PENDING' || train_status == 'TRAINING') {
                        Alert.alert('', `해당 학습정보로 훈련이 진행중이므로 삭제할 수 없습니다. 학습이 완료된 이후 다시 시도해주세요.`);
                        return;
                    }

                    if (apply_yn == 'Y') {
                        Alert.alert('', `시스템에 적용중인 모델은 삭제할 수 없습니다. 삭제를 원하시는 경우, 시스템적용 여부를 OFF로 설정해주세요.`);
                        return;
                    }

                    Alert.confirm('', '모델 학습 정보를 삭제하시겠습니까?', () => {
                        _this.deleteTrainConfig();
                    });

                } else {
                    Alert.alert('info', "삭제할 학습 정보를 선택해주세요.")
                }
            });

            kendoUtil.bindButton('#btnTrainStart', null, 'success', () => {
                if (_this.mt_id) {
                    Alert.confirm('', 'AI 학습을 시작하시겠습니까?', () => {
                        _this.startTrain();
                    });
                } else {
                    Alert.alert('info', "먼저 학습 정보를 선택해주세요.")
                }
            });

            // 모델 성능 지표 excel 다운로드
            kendoUtil.bindButton('#btnExcelMetric', 'file-excel', 'success', () => {
                if (!_this.mt_id) {
                    Alert.alert('error', '상단 목록에서 학습정보를 선택해 주세요.');
                    return;
                }

                kendoUtil.saveAsExcel('#model_score_grid', "모델 성능지표 데이터");
            });
        }

        initGrids() {
            let _this = this;
            // 모델 목록 그리드(main grid) 초기화
            _this.modelGrid = new TreeGrid($('#model_grid'), _this.getGridOptions('model_grid'));
            _this.totalTagGrid = new Grid($("#total_tag_grid"), _this.getGridOptions('total_tag_grid'));
            _this.modelTagGrid = new Grid($("#model_tag_grid"), _this.getGridOptions('model_tag_grid'));
            _this.searchMainData();
        }

        initTabStrip() {
            let _this = this;
            $("#tabstrip").kendoTabStrip({
                animation: { open: { effects: "fadeIn" } },
                activate: function (e) {
                    let activeTabIndex = $(e.item).index();
                    _this.loadContentByTab(activeTabIndex, false);
                }
            });
            // 초기 로드시 기본 탭(Tab1, 인덱스 0)과 첫번째 열람 여부를 명시적으로 로드
            _this.loadContentByTab(0, true);
        }
        // init 끝


        addVar(userVar = false) {
            let _this = this;

            // grid 객체 자체에 접근 가능해야 getSelect 사용 가능(전역으로 그리드 객체 선언)
            let selectedTTRows = _this.totalTagGrid.getSelect();
            let modelTagList = $("#model_tag_grid").data("kendoGrid");
            let ds = modelTagList.dataSource;
            let items = ds.data();

            // 기존 순서중(var_index) 최대값 찾기
            let maxOrder = items.length > 0
                ? Math.max(...items.map(i => i.var_index || 0)) + 1 // 순서 필드가 존재할 경우 최대값 + 1
                : 1; // default값

            if (userVar) {
                // 사용자 정의 변수 추가
                let data = {
                    data_source: 'USER',
                    table_name: null,
                    var_code: null,
                    var_name: null,
                    var_index: maxOrder,
                    is_editable: true   // 수정 가능하게
                };

                ds.add(data);
                console.log("MT new data", data);
                console.log("MT dataSource", items);
            }
            // total tag grid에서 정해져있는 변수를 추가할 때
            else {
                // 선택된 태그가 없으면
                if (!selectedTTRows.length > 0) {
                    Alert.alert('', '선택된 변수가 없습니다.');
                    return;
                }

                let existingCodes = items.map(i => i.var_code); // 기존 data의 var_code 목록
                let duplicated = false; // 중복 확인 플래그
                let addedCount = 0; // index 정렬을 위한 count값

                // 멀티 셀렉트
                selectedTTRows.forEach((tagItem) => {
                    // 이미 태그집합에 존재하는 변수는 add에서 제외
                    if (existingCodes.includes(tagItem.var_code)) {
                        duplicated = true;
                        return;
                    }

                    let data = {
                        data_source: tagItem.data_source,
                        table_name: tagItem.table_name,
                        var_code: tagItem.var_code,
                        var_name: tagItem.var_name,
                        var_index: maxOrder + addedCount, // 순차적 증가
                        is_editable: false
                    };

                    ds.add(data); // dataSource.add()를 쓰면 바로 화면에 반영됨
                    addedCount++; // add한 경우에만 증가
                });

                if (duplicated) {
                    Alert.alert('info', '선택된 변수 중, 이미 태그집합에 추가된 변수가 존재합니다. 중복된 변수를 제외한 나머지 변수가 추가되었습니다.');
                }
            }

            modelTagList.autoFitColumns();

        }

        deleteVar() {
            let _this = this;

            let selectedMTRows = _this.modelTagGrid.getSelect();
            let modelTagList = $("#model_tag_grid").data("kendoGrid");
            let ds = modelTagList.dataSource;
            let items = ds.data();

            // 선택된 태그가 없으면
            if (!selectedMTRows.length > 0) {
                Alert.alert('', '선택된 변수가 없습니다.');
                return;
            }

            // 멀티 셀렉트 삭제
            selectedMTRows.forEach((row, idx) => {
                ds.remove(row);
                //ds.remove(items[idx]);
            });

            // 2. 순서 재정렬
            let newOrder = 0;
            let step = 1;

            items.forEach((item, index) => {
                item.set("var_index", index + 1);
            });

            modelTagList.autoFitColumns();
        }

        saveModelTag() {
            let _this = this;
            let data = [];

            let tagItem = _this.modelTagGrid.getData();
            console.log("tagItem", tagItem);

            if (tagItem.length == 0) {
                Alert.alert('error', '선택된 변수(태그)가 없습니다.');
                return;
            }

            //if (!_this.md_id) {
            //    Alert.alert('error', '태그집합을 저장할 모델이 생성되지 않았습니다.');
            //    return;
            //}

            // 모델 저장 후 md_id가 생성되면 태그 저장
            tagItem.forEach(function (item, idx) {
                data.push({
                    data_source: item.data_source,
                    table_name: item.table_name,
                    var_code: item.var_code,
                    var_name: item.var_name,
                    var_index: idx // 그리드를 조작하는 과정에 순서가 바뀔 수 있으므로 저장할 때는 그리드가 가지고있는 idx로 다시 리셋
                });
            });

            console.log("model Tag data", data);

            let param = {
                md_id: _this.md_id,
                data: JSON.stringify(data)
            }

            let fnsuccess = function (result) {
                Notify.success('저장되었습니다.');
                _this.renderGrid("model_tag_grid", "model_tag_list");
            };

            // 모델 태그 저장 api 작성 후 api형식에 맞게 위에 정리
            AjaxUtil.postAsyncData(_this.baseUrl + '?action=save_model_tag', param, fnsuccess);
        }

        saveModel(withTag = null) {
            let _this = this;
            let url = _this.baseUrl + '?action=save_ds_model';

            let data = FormUtil.extractForm($('#modelTagForm'));
            data['mm_id'] = _this.mm_id;
            console.log('modelTagForm data', data);

            if (checkForm($('#modelTagForm')) === false) return;

            let fnSuccess = function (resp) {
                if (resp.success) {
                    Notify.success('저장되었습니다.');
                    _this.md_id = resp.md_id;
                    _this.modelGrid.grid.expandOn = true;
                    _this.searchMainData();

                    let modelFormData = _this.getDsInfo();
                    FormUtil.BindDataForm(modelFormData, $('#modelTagForm'));
                    _this.controlButtonState();

                    if (withTag) {
                        _this.saveModelTag();
                    }
                }
                else {
                    Alert.alert('error', resp.message);
                }
            }

            AjaxUtil.postAsyncData(url, data, fnSuccess);
        }



        // tag 드롭다운 선택 사항에 따른 이벤트 핸들링
        //setupDropdowns(config) {
        //    const { lineId, equipId, tagGroupId, tagId, mtrlId } = config;

        //    let line = lineId ? $(`#${lineId}`) : null;
        //    let equip = $(`#${equipId}`);
        //    let tagGroup = tagGroupId ? $(`#${tagGroupId}`) : null;
        //    let tag = tagId ? $(`#${tagId}`) : null;
        //    let mtrl = mtrlId ? $(`#${mtrlId}`) : null;

        //    // 드롭다운 초기화
        //    if (line) AjaxUtil.fillDropDownOptions(line, 'line', 'all', null);
        //    AjaxUtil.fillDropDownOptions(equip, 'equipment', 'all', null);
        //    if (tagGroup) AjaxUtil.fillDropDownOptions(tagGroup, 'tag_group', 'all', null);
        //    if (tag) AjaxUtil.fillDropDownOptions(tag, 'tag', 'all', null);
        //    if (mtrl) AjaxUtil.fillDropDownOptions(mtrl, 'material', 'all', null);

        //    // 이벤트 핸들러
        //    if (line) {
        //        line.change(function () {
        //            AjaxUtil.fillDropDownOptions(equip, 'equipment', 'all', null, null, null, line.val());
        //        });
        //    }

        //    equip.change(function () {
        //        if (tag) {
        //            AjaxUtil.fillDropDownOptions(tag, 'tag', 'all', null, equip.val(), tagGroup ? tagGroup.val() : null);
        //        }
        //    });

        //    if (tagGroup) {
        //        tagGroup.change(function () {
        //            AjaxUtil.fillDropDownOptions(tag, 'tag', 'all', null, equip.val() ? equip.val() : null, tagGroup.val());
        //        });
        //    }
        //}

        controlButtonState() {
            const hasMmId = !!this.mm_id;
            const hasMdId = !!this.md_id;
            const hasMtId = !!this.mt_id;

            // 데이터(csv) 기반 - 등록 버튼은 md_id가 없고 mm_id만 있을 때(모델 생성 전)
            $('#btnNewData').toggle(hasMmId && !hasMdId);
            // 데이터(csv) 기반 - 수정/삭제/수집 버튼은 md_id가 있을 때만
            $('#btnEditData, #btnDeleteData').toggle(hasMdId);

            // 태그집합 form 버튼 - 삭제/수집 버튼은 md_id가 있을 때만(mt_id가 생기는 경우 disabled되도록 처리함)
            $('#btnDeleteModel, #btnGatherTagData').toggle(hasMdId);

            // total_tag_grid를 제외한 excel 다운로드 버튼은 md_id 또는 mt_id가 있을 때만 표출.
            $('#btnExcelDetail, #btnExcelStat, #btnExcelPreprocess, #btnExcelXY, #btnExcelCorr').toggle(hasMdId);
            $('#btnExcelMetric').toggle(hasMtId); // 모델 성능 지표는 mt_id가 있을 때만
        }

        getGridOptions(gridName) {
            let _this = this;
            let defaultOption = {
                pageable: false,
                columns: [],
                height: "350px"
            };

            // gridName에 따른 특정 옵션 (columns 설정)
            let specificOption;

            // data가 없을 때 그리드에 뜨는 메시지
            let noDataMessage = "태그를 조합하거나 CSV 파일을 업로드하여 AI 모델을 생성하세요. 데이터가 등록되면 기본 모델이 생성되며, 이후 과정에 따라 알고리즘과 모델 정보가 자동으로 업데이트됩니다.";
            let noDataTemplate = `<div style='position: absolute; top: 0; left: 0; width: 100%; padding:10px; text-align:left;'> ${noDataMessage} </div>`;
            const getNoDataTemplate = () =>
                `<div style='position: absolute; top: 0; left: 0; width: 100%; padding:10px; text-align:left;'> ${noDataMessage} </div>`;

            switch (gridName) {

                case 'model_grid':
                    specificOption = {
                        pageable: false,
                        editable: false,
                        columnMenu: {
                            componentType: "classic",
                            autoSize: true,
                            clearAllFilters: true,
                            columns: { sort: "asc" }
                        },
                        columns: [
                            // number 쓰면 tree구조 고장남
                            //{ title: 'No', template: (dataItem) => `<div>${dataItem.index + 1}</div>`, width: 50, attributes: { style: 'text-align: center' } },
                            { field: 'id', hidden: true },
                            { field: 'node_type', title: '구분', width: 100 },
                            { field: 'name', title: '이름', width: 150 },
                            { field: 'equip_name', title: '설비', width: 150 },
                            { field: 'type', title: '유형', width: 50 },
                            { field: 'ver', title: 'Ver', width: 100 },
                            { field: 'description', title: '설명', width: 150 },
                            //{ field: 'cycle', title: '모델생성주기', width: 100 },
                            { field: 'var_count', title: '변수개수', width: 60 },
                            { field: 'file_name', title: '원본파일명', width: 100 },
                            //{ field: 'algorithm_type', title: 'ML(알고리즘)', width: 100 },
                            //{ field: '_created', title: '등록일', width: 100 }
                        ],
                        change: function (e) {
                            let activeTab = $("#tabstrip").data("kendoTabStrip").select().index();
                            // 현재 열려있는 탭에서만 선택된 모델의 데이터 갱신
                            _this.loadContentByTab(activeTab, false);
                        },
                        dataBound: function (e) {
                            const grid = this;

                            // 그리드 행 번호 자동 업데이트
                            let items = grid.items();
                            items.each(function (index) {
                                $(this).find("td:first").html(index + 1);
                            });

                            kendoUtil.showGridRowCount(grid.element);

                            // 트리 노드 펼치기
                            if (grid.expandOn) {
                                // 특정 mm_id 노드만 펼치기(mm_id가 있으면 mm_id만, md_id가 있으면 md_id까지 확장)
                                if (_this.mm_id) {
                                    const rows = grid.tbody.find(">tr");
                                    rows.each(function () {
                                        if ($(this).data("master_id") == _this.mm_id) {
                                            grid.expand(this);
                                        }
                                    });

                                    // mm_id가 있으면 mm_id까지 확장
                                    if (_this.md_id) {
                                        rows.each(function () {
                                            if ($(this).data("model_id") == _this.md_id) {
                                                grid.expand(this);
                                            }
                                        });
                                    }
                                }

                                // 기존 로직
                                //const rows = grid.tbody.find(">tr");
                                //rows.each(function () {
                                //    grid.expand(this);
                                //});
                                //grid.expandOn = false;
                            }
                        },
                        height: "300px"
                    };
                    break;

                case 'total_tag_grid':
                    let notSelected = '상단 목록에서 태그 목록을 조회할 마스터를 선택해주세요.';
                    specificOption = {
                        pageable: false,
                        columns: [
                            { selectable: true, width: 30, attributes: { style: "display: flex; justify-content:center;" }, headerAttributes: { style: "display: flex; justify-content:center;" } },
                            { title: 'No', template: (dataItem) => `<div>${dataItem.index + 1}</div>`, width: 50, attributes: { style: 'text-align: center' } },
                            //    { field: 'equipment_name', title: '설비명', width: 125 },
                            //    { field: 'tag_group_name', title: '태그그룹명', width: 125 },
                            { field: 'data_source', title: '데이터소스', width: 100 },
                            { field: 'table_name', title: '테이블명', width: 150 },
                            { field: 'var_code', title: '변수코드', width: 200 },
                            { field: 'var_name', title: '변수명', width: 200 },
                            //    { field: 'var_type', title: '변수유형', width: 100 },
                        ],
                        height: "580px",
                        noRecords: {
                            template: `<div style='position: absolute; top: 0; left: 0; width: 100 %; padding: 10px; text- align: left;'> ${notSelected} </div>`
                        },
                        dataBound: function (e) {
                            let items = this.items();
                            items.each(function (index) {
                                //$(this).find("td:first").html(index + 1);
                                $(this).find("td:eq(1)").html(index + 1);  // 두 번째 셀이 No이므로 조건 수정
                            });

                            kendoUtil.showGridRowCount(this.element);
                        }
                    };
                    break;

                case 'model_tag_grid':
                    specificOption = {
                        pageable: false,
                        //editable: true,
                        editable: {
                            //mode: "inline", // 또는 "incell", "popup"
                            createAt: "bottom" // 새 행을 하단에 추가
                        },
                        columns: [
                            // check box
                            {
                                selectable: true,
                                width: 30,
                                attributes: { style: "display: flex; justify-content:center;" },
                                headerAttributes: { style: "display: flex; justify-content:center;" },
                            },
                            //{ title: 'No', template: (dataItem) => `<div>${dataItem.index + 1}</div>`, width: 50, attributes: { style: 'text-align: center' } },
                            //{ field: 'line', title: '라인', width: 100 },
                            //{ field: 'equipment_name', title: '설비명', width: 150 },
                            { field: 'var_index', title: '순서', width: 50, attributes: { style: 'text-align: center' }, editable: () => false },
                            { field: 'data_source', title: '데이터소스', width: 100, editable: () => false },
                            { field: 'table_name', title: '테이블명', width: 150 },
                            { field: 'var_code', title: '변수코드', width: 200 },
                            { field: 'var_name', title: '변수명', width: 200 },
                            //{ command: "edit" }
                        ],
                        height: "300px",
                        edit: function (e) {
                            let item = e.model;
                            // is_editable 필드가 false인 경우 수정 막기(사용자 정의 변수 추가시에만 수정 가능)
                            if (!item.is_editable) {
                                e.sender.closeCell();
                            }
                        },
                        dataBound: function (e) {
                            let items = this.items();
                            items.each(function (index) {
                                //$(this).find("td:first").html(index + 1);
                                $(this).find("td:eq(1)").html(index + 1);  // 두 번째 셀이 index이므로 eq(1)로 조건 수정. 실제 var_index값이랑은 별개로 index값이 표출되니 주의.
                            });

                            kendoUtil.showGridRowCount(this.element);
                        }
                    };
                    break;

                case 'data_detail_grid':
                    //modified by choi : 2025/08/05
                    //                 : pageSize, buttonCount, height를 크게 설정함
                    specificOption = {
                        //pageable: false,
                        pageable: {
                            refresh: false,  // 새로고침 버튼 추가
                            pageSize: 100,  // 기본 페이지 크기
                            pageSizes: [10, 20, 50, 100, "all"],  // 선택 가능한 페이지 크기
                            buttonCount: 10  // 페이지네이션 버튼 개수 25.08.19 김하늘 수정(최대값 10)
                        },
                        //dataSource: new kendo.data.DataSource({
                        //    pageSize: 50,  // 기본 페이지 크기
                        //    serverPaging: false,  // 서버 페이징 비활성화 (클라이언트 페이징만 사용)
                        //    data: []  // 초기 데이터 비워두기
                        //}),
                        columns: [
                            // data에 따라 달라지므로 동적으로 생성
                        ],
                        height: "350px",
                        noRecords: {
                            template: getNoDataTemplate()
                        }
                    };
                    break;

                case 'ds_col_grid':
                    specificOption = {
                        pageable: false,
                        columns: [
                            { title: 'No', template: (dataItem) => `<div>${dataItem.index + 1}</div>`, width: 50, attributes: { style: 'text-align: center' } },
                            { field: 'VarName', title: '변수명', width: 150 },
                            { field: 'DataCount', title: '데이터개수', width: 100 },
                            { field: 'MissingCount', title: '결측치개수', width: 100 },
                            { field: 'CategoryCount', title: '범주개수', width: 100 },
                            { field: 'Mean', title: '평균', width: 100 },
                            { field: 'Std', title: '표준편차', width: 100 },
                            { field: 'Q1', title: 'Q1', width: 100 },
                            { field: 'Q2', title: 'Q2', width: 100 },
                            { field: 'Q3', title: 'Q3', width: 100 }
                        ],
                        height: "350px",
                        noRecords: {
                            template: getNoDataTemplate()
                        }
                    };
                    break;

                case 'ds_col_grid2':
                    specificOption = {
                        pageable: false,
                        editable: true,  // 편집 가능하도록 설정(콤보박스용)
                        columns: [
                            { title: 'No', template: (dataItem) => `<div>${dataItem.index + 1}</div>`, width: 50, attributes: { style: 'text-align: center' } },
                            { field: 'VarName', title: '변수명', width: 150, editable: () => false },
                            {
                                field: "MissingValProcess",
                                title: "결측치 처리방법",
                                width: 120,
                                attributes: { style: "text-align: center" },
                                template: function (dataItem) {
                                    let selectedOption = _this.mission_proc_options.find(opt => opt.code == dataItem.MissingValProcess);
                                    return `<select name="MissingValProcess" class="k-picker k-dropdownlist k-picker-solid k-picker-md k-rounded-md k-valid">
                                                <option selected value="${selectedOption ? selectedOption.code : ''}">${selectedOption ? selectedOption.name : "선택"}</option>
                                            </select>`;
                                },
                                // 임의로 editor 형식으로 변환되는 것 방지
                                editable: () => false
                            },
                            {
                                field: "DropOutLow",
                                title: "이상치하한",
                                width: 100,
                                attributes: { style: "text-align: center" },
                                template: function (dataItem) {
                                    let value = dataItem.DropOutLow ?? "";
                                    let displayValue = value == null ? "입력" : value; // ✅ 값이 없으면 "입력" 표시
                                    return `<input name="DropOutLow" class="k-input k-textbox k-input-solid k-input-md k-rounded-md"
                                              value="${displayValue}" placeholder="입력" />`;
                                },
                                editor: function (container, options) {
                                    $('<input name="DropOutLow"/>')
                                        .appendTo(container)
                                        .kendoTextBox({
                                            value: options.model.DropOutLow ?? null, // ✅ 값이 없으면 placeholder로 "입력" 표시
                                            placeholder: "입력",
                                            change: function (e) {
                                                let newValue = e.sender.value().trim();
                                                options.model.set("DropOutLow", newValue === "" ? null : newValue); // ✅ 빈 값이면 null 처리
                                            },
                                            //    width: "100%"
                                        });
                                }
                            },
                            {
                                field: "DropOutUpper",
                                title: "이상치상한",
                                width: 100,
                                attributes: { style: "text-align: center" },
                                template: function (dataItem) {
                                    let value = dataItem.DropOutUpper ?? "";
                                    let displayValue = value == null ? "입력" : value; // ✅ 값이 없으면 "입력" 표시
                                    return `<input name="DropOutUpper" class="k-input k-textbox k-input-solid k-input-md k-rounded-md"
                                            value="${displayValue}" placeholder="입력" />`;
                                },
                                editor: function (container, options) {
                                    $('<input name="DropOutUpper"/>')
                                        .appendTo(container)
                                        .kendoTextBox({
                                            value: options.model.DropOutUpper ?? null, // ✅ 값이 없으면 placeholder로 "입력" 표시
                                            placeholder: "입력",
                                            change: function (e) {
                                                let newValue = e.sender.value().trim();
                                                options.model.set("DropOutUpper", newValue === "" ? null : newValue); // ✅ 빈 값이면 null 처리
                                            },
                                            //    width: "100%"
                                        });
                                }
                            },
                            { field: 'DataCount', title: '데이터수', width: 80, editable: () => false },
                            { field: 'MissingCount', title: '결측치수', width: 80, editable: () => false },
                            { field: 'CategoryCount', title: '범주개수', width: 80, editable: () => false },
                            { field: 'Mean', title: '평균', width: 80, editable: () => false },
                            { field: 'Std', title: '표준편차', width: 80, editable: () => false },
                            { field: 'Q1', title: 'Q1', width: 80, editable: () => false },
                            { field: 'Q2', title: 'Q2', width: 80, editable: () => false },
                            { field: 'Q3', title: 'Q3', width: 80, editable: () => false },

                        ],
                        dataBound: function (e) {
                            let grid = this;

                            // ✅ DropDownList 바인딩 (MissingValProcess)
                            grid.tbody.find("select[name='MissingValProcess']").each(function () {
                                let select = $(this);
                                let row = select.closest("tr");
                                let dataItem = grid.dataItem(row);

                                select.kendoDropDownList({
                                    dataSource: _this.mission_proc_options, // ✅ "-" 옵션 그대로 유지
                                    dataTextField: "name",
                                    dataValueField: "code",
                                    value: dataItem.MissingValProcess || "", // ✅ 빈 값이면 "-"가 표시됨
                                    optionLabel: "선택", // ✅ "선택"이 표시되지만 "-"도 그대로 유지
                                    change: function (e) {
                                        dataItem.set("MissingValProcess", e.sender.value());
                                    }
                                });
                            });

                            // 그리드 행 번호 자동 업데이트
                            let items = grid.items();
                            items.each(function (index) {
                                $(this).find("td:first").html(index + 1);
                            });

                            kendoUtil.showGridRowCount(this.element);
                        },
                        height: "350px",
                        noRecords: {
                            template: getNoDataTemplate()
                        }
                    };
                    break;

                case 'settingXy_grid':
                    specificOption = {
                        pageable: false,
                        sortable: false,    // 해당 기능 true 되면 check 선택 이벤트보다 sort 이벤트가 실행됨
                        filterable: false,
                        editable: false,  // 어차피 dom으로 직접 조작해서 value 주기 때문에 false로
                        columns: [
                            { title: 'No', template: (dataItem) => `<div>${dataItem.index + 1}</div>`, width: 50, attributes: { style: 'text-align: center' } },
                            { field: 'VarName', title: '변수명', width: 150 },
                            {
                                field: 'X',
                                width: 80,
                                headerTemplate: '<input type="checkbox" class="chkbx k-checkbox k-checkbox-md k-rounded-md" id="x_all_check"/>X변수',
                                attributes: { style: "text-align: center" },
                                template: function (item) {
                                    return '<input name="chkbx_x" type="checkbox"' + (item.X == 1 ? 'checked="checked"' : '') + 'class="chkbx k-checkbox k-checkbox-md k-rounded-md" />';
                                },
                            },
                            {
                                field: 'Y',
                                width: 80,
                                //headerTemplate: '<input type="checkbox" class="chkbx k-checkbox k-checkbox-md k-rounded-md" id="y_all_check"/>Y변수',
                                attributes: { style: "text-align: center" },
                                title: 'Y변수',
                                template: function (item) {
                                    return '<input name="chkbx_y" type="checkbox"' + (item.Y == 1 ? 'checked="checked"' : '') + 'class="chkbx k-checkbox k-checkbox-md k-rounded-md" />';
                                },
                            },
                            { field: 'DataCount', title: '데이터개수', width: 100 },
                            { field: 'MissingCount', title: '결측치개수', width: 100 },
                            { field: 'CategoryCount', title: '범주개수', width: 80 },
                            { field: 'Mean', title: '평균', width: 80 },
                            { field: 'Std', title: '표준편차', width: 80 },
                            { field: 'Q1', title: 'Q1', width: 80 },
                            { field: 'Q2', title: 'Q2', width: 80 },
                            { field: 'Q3', title: 'Q3', width: 80 },
                            { field: "MissingValProcess", title: "결측치 처리방법", width: 120 },
                            { field: "DropOutLow", title: "이상치하한", width: 100 },
                            { field: "DropOutUpper", title: "이상치상한", width: 100 }
                        ],
                        dataBound: function (e) {
                            let grid = this;
                            let items = grid.items();

                            // 개별 X 체크박스 클릭 시 데이터 반영
                            grid.element.find("input[name='chkbx_x']").on("change", function () {
                                let row = $(this).closest("tr");
                                let dataItem = grid.dataItem(row);
                                dataItem.set("X", this.checked ? 1 : 0);
                            });

                            // 개별 Y 체크박스 클릭 시 데이터 반영
                            grid.element.find("input[name='chkbx_y']").on("change", function () {
                                let row = $(this).closest("tr");
                                let dataItem = grid.dataItem(row);

                                //임시 y 1개만 지정 해제
                                //dataItem.set("Y", this.checked ? 1 : 0);

                                console.log("1", grid.element.find("input[name='chkbx_y']:checked"));
                                if (this.checked) {
                                    console.log("2", grid.element.find("input[name='chkbx_y']:checked"));

                                    // Y가 이미 선택된 상태인지 확인 (본인이 체크되기 전 기준)
                                    // 현재 체크된 상태에서 Y가 이미 선택된 항목이 있는지 확인
                                    let existingChecked = grid.element.find("input[name='chkbx_y']:checked").not(this);

                                    if (existingChecked.length > 0) {
                                        console.log("3", grid.element.find("input[name='chkbx_y']:checked"));

                                        Alert.alert("error", "Y변수는 하나만 선택할 수 있습니다.");
                                        $(this).prop("checked", false);  // 방금 체크한 거 해제
                                        return;
                                    }
                                    console.log("4", grid.element.find("input[name='chkbx_y']:checked"));
                                    // ✅ 기존 Y 해제 후 현재 선택 반영
                                    grid.dataSource.data().forEach(item => item.set("Y", 0));
                                    dataItem.set("Y", 1);
                                } else {
                                    // ✅ 체크 해제된 경우 데이터 반영
                                    dataItem.set("Y", 0);
                                }
                                console.log("5", grid.element.find("input[name='chkbx_y']:checked"));

                            });

                            // X 전체 선택 버튼 이벤트 (Y는 단일 선택이라 없음)
                            $("#x_all_check").on("click", function () {
                                let checked = $(this).prop("checked");
                                // data 업데이트
                                console.log("checked1", checked);
                                grid.dataSource.data().forEach(item => item.set("X", checked ? 1 : 0));
                                // UI 업데이트 (체크박스 상태)
                                console.log("checked2", checked);
                                $('input[name="chkbx_x"]').prop("checked", checked);
                                console.log("checked3", checked);
                            });

                            // 행 번호 추가
                            items.each(function (index) {
                                $(this).find("td:first").html(index + 1);
                            });

                            // 그리드 row 개수 표시
                            kendoUtil.showGridRowCount(this.element);
                        },
                        height: "350px",
                        noRecords: {
                            template: getNoDataTemplate()
                        },
                    };
                    break;

                case 'corr_grid':
                    noDataMessage = "상관관계값의 경우 X,Y변수가 지정되어야 연산이 가능하므로, XY지정 탭에서 X변수와 Y변수를 지정해주세요.";
                    specificOption = {
                        pageable: false,
                        columns: [
                            //{ title: 'No', template: (dataItem) => `<div>${dataItem.index + 1}</div>`, width: 50, attributes: { style: 'text-align: center' } },
                            { field: 'YVarName', title: 'Y변수', width: 80 },
                            { field: 'data_type', title: '구분', width: 80 },
                            { field: 'intercept_', title: '절편', width: 80 }
                        ],
                        height: "350px",
                        noRecords: {
                            template: getNoDataTemplate()
                        }
                    };
                    console.log("noDataTemplate", noDataTemplate);
                    console.log("noDataMessage", noDataMessage);
                    break;
                // 필요시 다른 탭(그리드) 옵션 추가 가능
                case 'model_score_grid':
                    noDataMessage = "모델 학습 결과가 없습니다. 학습 정보 생성 후, 버튼을 눌러 학습을 진행해 주세요. 이미 학습을 진행하신 경우, 상단 목록에서 해당 학습 정보를 선택해 주세요.";
                    specificOption = {
                        pageable: false,
                        columns: [
                            { title: 'No', template: (dataItem) => `<div>${dataItem.index + 1}</div>`, width: 50, attributes: { style: 'text-align: center' } },
                            { field: 'MetricName', title: '성능지표명', width: 200 },
                            { field: 'MetricValue', title: '점수', width: 80, type: "number", format: "{0:0.00}" },
                            { field: 'DatasetType', title: '평가데이터', width: 100 }
                        ],
                        height: "280px",
                        noRecords: {
                            template: getNoDataTemplate()
                        }
                    };
                    break;

                default:
                    specificOption = defaultOption;
            }

            let gridOptions = specificOption;

            if (!gridOptions.dataBound) {
                // dataBound를 따로 설정하지 않은 그리드는 공통사항을 할당
                gridOptions.dataBound = function (e) {
                    let items = this.items();
                    items.each(function (index) {
                        $(this).find("td:first").html(index + 1);
                    });

                    kendoUtil.showGridRowCount(this.element);

                    //this.autoFitColumn(this.columns);
                    this.autoFitColumns();
                };
            }

            console.log("gridOptions", gridOptions);

            return gridOptions;
        }

        loadContentByTab(tabIndex, first = false) {
            let _this = this;

            let selectedModel = null;

            // 페이지가 처음 로드 될 때는 모델 선택 alert이 발생하지 않도록, 표출 여부를 false로 전달
            if (first) {
                selectedModel = _this.getSelectedModel(false);
            } else {
                selectedModel = _this.getSelectedModel(true, tabIndex);
            }

            // 선택된 모델이 없으면 정지. 단, 페이지를 처음 로드할 때는 계속 진행
            if (!selectedModel && !(first && tabIndex === 0)) {
                return;
            }

            // 탭 인덱스에 따라 해당 탭의 컨테이너를 초기화 또는 갱신
            switch (tabIndex) {
                case 0:
                    _this.renderGrid("total_tag_grid", "integrated_tag_list", { mm_id: _this.mm_id });
                    _this.renderGrid("model_tag_grid", "model_tag_list");

                    let disableCheck = false; // 태그 집합 form btn & info toggle을 위한 플래그
                    // 모델이 이미 생성되었을 때
                    if (selectedModel && selectedModel.model_id) {
                        // 기존방식을 (grid에서 선택한 데이터 바인딩)사용하면 model form에 훈련 정보가 바인딩 될 수 있음(뭘 눌러도 모델 정보가 바인딩 되어야함.)
                        let data = _this.getDsInfo();
                        FormUtil.BindDataForm(data, $('#modelTagForm'));

                        if (selectedModel.hasChildren || selectedModel.train_id) {
                            disableCheck = true; // 훈련 정보가 이미 있는 경우 모델 정보 변경 불가
                        }
                    } else {
                        // 모델이 없을 때(마스터 선택)
                        FormUtil.resetForm($('#modelTagForm'));
                    }
                    $('#model_tag_info').toggle(disableCheck);
                    // excel export 버튼 제외한 버튼 비활성화
                    $('#model_tag_tab').find('button').not('#btnExcelTotal').prop('disabled', disableCheck);
                    //$('#model_tag_tab').find('button').prop('disabled', disableCheck);
                    disableCheck ? FormUtil.disableForm($('#modelTagForm')) : FormUtil.enableForm($('#modelTagForm'));
                    _this.controlButtonState();  //버튼 토글
                    break;
                case 1:
                    _this.renderGrid("data_detail_grid", "ds_rows_list");
                    _this.controlButtonState();  //그리드에서 선택한 모델에 따른 버튼 토글
                    break;
                case 2:
                    _this.renderGrid("ds_col_grid", "ds_col_list");
                    _this.controlButtonState();  //그리드에서 선택한 모델에 따른 버튼 토글
                    break;
                case 3:
                    _this.loadChartImage("num_dist_chart", "ds_numcol_boxhist");
                    break;
                case 4:
                    // 범주형 변수 리스트
                    let cate_var_list = $("#cate_vari").data("kendoMultiSelect");
                    if (cate_var_list) {
                        cate_var_list.setDataSource(_this.fillCategoryVars());
                        // 선택된 모델 변경시 차트 초기화
                        if (!cate_var_list.value().length) {
                            $('#cat_dist_chart').attr('src', '').css('opacity', 0);
                        }
                        console.log("cate_var_list", cate_var_list);
                    }
                    break;
                case 5:
                    _this.renderGrid("ds_col_grid2", "ds_col_list");
                    _this.controlButtonState();  //그리드에서 선택한 모델에 따른 버튼 토글
                    break;
                case 6:
                    _this.loadChartImage("heatmap_chart", "ds_heatmap");
                    break;
                case 7:
                    _this.renderGrid("settingXy_grid", "ds_col_list");
                    _this.controlButtonState();  //그리드에서 선택한 모델에 따른 버튼 토글
                    break;
                case 8:
                    _this.loadChartImage("scatter_chart", "ds_col_scatter");
                    break;
                case 9:
                    _this.renderGrid("corr_grid", "ds_var_corr_sheet");
                    _this.controlButtonState();  //그리드에서 선택한 모델에 따른 버튼 토글
                    break;
                case 10:
                    // Tab11: 주성분분석은 누적설명률 차트 및 결과 영역(pca_plotly, pca_result)을 별도로 처리
                    // pca 차원축소 범위 리스트(실제 변수 개수)
                    let pca_dim_list = $("#pca_num_dim").data("kendoDropDownList");
                    if (pca_dim_list) {
                        pca_dim_list.setDataSource([]);
                        console.log("pca_dim_list", pca_dim_list);
                    }
                    _this.loadChartImage("pca_plotly", "pca_evr");
                    break;
                case 11:
                    // 학습정보가 있는 경우에는 정보를 불러오고, 없는 경우엔 빈 폼
                    if (_this.mt_id) {
                        let formData = _this.getTrainInfo();
                        _this.initTrainForm(formData);  // 기존 객체 불러오기 → new_check 생략
                    } else {
                        _this.initTrainForm(null, { new_check: true });  // 신규 → 명시적 전달
                    }
                    _this.updateTrainButtons();
                    _this.renderGrid("model_score_grid", "model_metric_list", { mt_id: _this.mt_id });
                    _this.controlButtonState();  //그리드에서 선택한 모델에 따른 버튼 토글
                    break;
                default:
                    console.log("해당 탭에 그리드 없음");
            }
        }

        //getSelectedModel(tabIndex, showAlert = true) {
        getSelectedModel(showAlert = true, tabIndex = null) {
            let _this = this;
            let data = _this.modelGrid.getSelect();

            //if (showAlert && tabIndex !== 0) {
            if (!data || data.length === 0) {
                if (showAlert) {
                    switch (tabIndex) {
                        case 1:
                            // 데이터 탭
                            Alert.alert('info',
                                '상단 목록에서 모델을 생성할 마스터를 선택해주세요. 이미 모델을 생성하신 경우, 데이터를 조회할 모델을 선택해 주세요.'

                                //'상단 목록에서 생성할 모델의 종류(마스터)를 선택해주세요.'
                                //+ '<br>이미 모델을 생성하신 경우, 데이터를 조회할 모델을 선택해 주세요.'
                            );
                            break;
                        case 11:
                            // 모델 생성 탭
                            Alert.alert('info',
                                '상단 목록에서 학습 정보를 생성할 모델을 선택해주세요. 이미 학습 정보를 생성하신 경우, 생성하신 학습 정보를 선택해 주세요.'
                            );
                            break;

                        default:
                            Alert.alert('info', '상단 목록에서 데이터를 조회할 모델을 선택해 주세요.');
                            break;
                    }
                }
                return null;
            }

            const selectData = data[0];
            console.log("선택된 모델:", data);
            console.log("선택된 모델[0]:", selectData);
            _this.mm_id = selectData.master_id;
            _this.md_id = selectData.model_id;
            _this.equ_id = selectData.equip_id;
            _this.mt_id = selectData.train_id; // 25.04.14 추가 (train 정보)

            return selectData;
        }


        renderGrid(gridId, action = null, extraParam = null) {
            let _this = this;
            let grid = $("#" + gridId).data("kendoGrid");
            let options = this.getGridOptions(gridId);

            if (grid) {
                /* 그리드 인스턴스가 이미 존재할 때,
                ** 이전에 조회했던 모델에 데이터가 없었던 경우 columns이 빈 배열로 초기화된 상태.
                ** 본래 컬럼 설정을 다시 찾아갈 수 있도록 재할당 */
                grid.options.columns = options.columns;

            } else {
                //if (gridId ='total_tag_grid') {
                //    _this.totalTagGrid = new Grid($("#" + gridId), options);
                //}
                //else {
                //    new Grid($("#" + gridId), options);
                //}
                new Grid($("#" + gridId), options);
            }

            // API 호출: action 값이 전달되면 공통 업데이트 함수 호출
            if (action) {
                if (extraParam) {
                    _this.updateGridData(gridId, action, extraParam);

                } else {
                    _this.updateGridData(gridId, action, { md_id: _this.md_id });
                }
            }
        }

        updateGridData(gridId, action, extraParam) {
            let _this = this;
            let param = Object.assign({ action: action }, extraParam || {});

            let gridInstance = $("#" + gridId).data("kendoGrid");
            kendo.ui.progress($("#" + gridId), true); // data 로딩 ui 시작

            // tab별 용도에 따라 고정으로 생성되어야 하는 컬럼(원천 데이터의 컬럼과 별개)
            let baseColumns = gridInstance.options.columns;

            let succFunc = function (result) {
                console.log("result", result);
                // xrows(컬럼)를 백엔드에서 보내주는 경우(데이터마다 컬럼이 달라지는 경우)
                if (result.xrows) {
                    if (result.xrows.length > 0) {
                        var dynamicColumns = result.xrows.map(function (item, index) {
                            return {
                                field: 'col_' + (index + 1),// col_ + 변수순서
                                //field: item.VarName,      // 필드 이름 (백엔드에서 보내는 컬럼명)
                                title: item.VarName,        // 제목 (화면에 표시될 텍스트)
                                width: item.width || 100,   // 백엔드에서 제공된 width가 없으면 기본값 100px 사용
                            };
                        });

                        if (baseColumns) {
                            console.log("baseColumns", baseColumns);
                            // base컬럼이 있으면 데이터의 컬럼들과 병합(정적 생성 + 동적 생성)
                            dynamicColumns = [...baseColumns, ...dynamicColumns];
                        }

                        // No. 이유는 알 수 없지만 첫번째 컬럼의 값이 row의 index로 바인딩되는 에러 발생(id 아님!)
                        // 이참에 그냥 index컬럼을 만들어버림
                        // "No" 컬럼이 없는 경우에만 추가.
                        if (!dynamicColumns.some(col => col.title === "No")) {
                            dynamicColumns.unshift({ "title": "No", "width": 50 });
                        }

                        console.log("dynamicColumns", dynamicColumns);

                        gridInstance.setOptions({ columns: dynamicColumns });
                        gridInstance.dataSource.data(result.rows);
                        //console.log("gridInstance.dataSource.data", gridInstance.dataSource.data());
                    } else {
                        // xrows는 있지만 빈 배열 일 때. 컬럼&데이터 초기화하여 noDataMessage 표시
                        let pageSize = gridInstance.dataSource.options.pageSize;

                        gridInstance.setOptions({
                            columns: [],
                            dataSource: {
                                // pageSize 설정이 덮어씌워져서 all로 바뀌는 것 방지
                                pageSize: pageSize ? pageSize : null,
                                page: pageSize ? 1 : null, // 페이지 속성이 있으면 첫 페이지로 이동
                                data: []
                            }
                        });
                    }
                } else {
                    // 일반적인 grid 데이터일 때
                    gridInstance.dataSource.data(result);
                }
                // 컬럼 크기 자동 조절
                gridInstance.autoFitColumns();

                kendo.ui.progress($("#" + gridId), false); // data 로딩 ui 끝
            }

            AjaxUtil.getAsyncData(_this.baseUrl, param, succFunc);
        }

        loadChartImage(chartId, action, extraParam = null) {
            let _this = this;

            // 그래프 초기화 PCA 차트는 `empty()`, 이미지 차트는 `src` 비우기
            if ($('#' + chartId).is('div')) {
                $('#' + chartId).empty();
                // PCA 수행 결과 로드 시, 이전에 생성된 설명률 차트도 남아있어야 하므로 여기서 초기화x
            } else {
                $('#' + chartId).attr('src', '').css('opacity', 0); // 이미지 차트
            }

            let param = {
                action: action,
                md_id: _this.md_id,
                ...extraParam
            };

            console.log("param", param);

            try {
                kendo.ui.progress($("#" + chartId).parent(), true);  // data 요청 전 로딩 ui 시작(부모 div에서)

                //let result = AjaxUtil.getSyncData(_this.baseUrl, param); // 동기 요청 후 결과 반환
                let succFunc = function (result) {
                    console.log("result", result);

                    if (result.pca_plotly) {
                        //let x_range = result.x_vars_len;
                        let x_range = result.x_vars_len ?? null;

                        // PCA 그래프 그리기
                        $('#' + chartId).html(result.pca_plotly);
                        //window.dispatchEvent(new Event('resize'));

                        // PCA 드롭다운 업데이트 (x_range가 있는 경우만)
                        if (x_range !== null) {
                            let pca_dim_list = $("#pca_num_dim").data("kendoDropDownList");
                            if (pca_dim_list) {
                                let dim_range = [];
                                for (let i = 1; i < parseInt(x_range); i++) {
                                    dim_range.push({ value: i, text: i });
                                }
                                console.log("dim_range", dim_range);
                                pca_dim_list.setDataSource(dim_range);
                            }

                            // 설명률 차트 업데이트 시, pca수행결과 차트 초기화
                            $('#' + chartId).siblings().empty();
                        }

                        kendo.ui.progress($("#" + chartId).parent(), false); // data 요청 전 로딩 ui 종료

                        return; // PCA 실행 후 일반 차트 실행 방지
                    }

                    else {
                        // 일반 차트(이미지)
                        _this.syncImageWithLink(chartId, result.chart_url);
                        //$('#' + chartId).attr('src', result.chart_url).css('opacity', 1);
                        kendo.ui.progress($("#" + chartId).parent(), false); // data 요청 전 로딩 ui 종료
                    }

                }

                let failFunc = function (result) {
                    $('#' + chartId).siblings().empty();

                    kendo.ui.progress($("#" + chartId).parent(), false); // data 요청 전 로딩 ui 종료
                    let errorMessage = null;

                    if (result?.not_enough_x_vars) {
                        errorMessage = "지정된 X변수가 1개 이하이므로 더이상 축소할 차원이 없습니다. <br>PCA 진행을 원하는 경우, XY지정 탭에서 X변수를 2개 이상 선택해주세요.";

                    } else if (result?.no_xy_message) {
                        errorMessage = "X, Y변수가 지정되어야 연산이 가능하므로, 먼저 XY지정 탭에서 X변수와 Y변수를 지정해주세요.";

                    } else {
                        errorMessage = `이미지 로드에 실패했습니다. 응답 성공 여부 확인이 필요합니다.\n응답: ${JSON.stringify(result)}`;
                        console.error("이미지 로드 실패: 응답 성공 여부 확인 필요", result);
                    }

                    Alert.alert(result?.not_enough_x_vars || result?.no_xy_message ? "info" : "error", errorMessage);

                }

                AjaxUtil.getAsyncData(_this.baseUrl, param, succFunc, failFunc); // 비동기 요청 후 결과 반환

                // 결과가 없거나 실패했을 경우, 먼저 처리하고 함수 종료
                //if (!result || !result.success) {
                //    // 실패 시 PCA 수행 결과 차트 초기화
                //    $('#' + chartId).siblings().empty();

                //    let errorMessage = null;

                //    if (result?.not_enough_x_vars) {
                //        errorMessage = "지정된 X변수가 1개 이하이므로 더이상 축소할 차원이 없습니다. <br>PCA 진행을 원하는 경우, XY지정 탭에서 X변수를 2개 이상 선택해주세요.";

                //    } else if (result?.no_xy_message) {
                //        errorMessage = "X, Y변수가 지정되어야 연산이 가능하므로, 먼저 XY지정 탭에서 X변수와 Y변수를 지정해주세요.";

                //    } else {
                //        errorMessage = `이미지 로드에 실패했습니다. 응답 성공 여부 확인이 필요합니다.\n응답: ${JSON.stringify(result)}`;
                //        console.error("이미지 로드 실패: 응답 성공 여부 확인 필요", result);
                //    }

                //    Alert.alert(result?.not_enough_x_vars || result?.no_xy_message ? "info" : "error", errorMessage);
                //    kendo.ui.progress($("#" + chartId).parent(), false); // data 요청 전 로딩 ui 종료

                //    return;
                //}

                //// pca 관련 그래프면 plotly로, 아니면 이미지로
                //if (result.pca_plotly) {
                //    //let x_range = result.x_vars_len;
                //    let x_range = result.x_vars_len ?? null;

                //    // PCA 그래프 그리기
                //    $('#' + chartId).html(result.pca_plotly);
                //    //window.dispatchEvent(new Event('resize'));

                //    // PCA 드롭다운 업데이트 (x_range가 있는 경우만)
                //    if (x_range !== null) {
                //        let pca_dim_list = $("#pca_num_dim").data("kendoDropDownList");
                //        if (pca_dim_list) {
                //            let dim_range = [];
                //            for (let i = 1; i < parseInt(x_range); i++) {
                //                dim_range.push({ value: i, text: i });
                //            }
                //            console.log("dim_range", dim_range);
                //            pca_dim_list.setDataSource(dim_range);
                //        }

                //        // 설명률 차트 업데이트 시, pca수행결과 차트 초기화
                //        $('#' + chartId).siblings().empty();
                //    }

                //    kendo.ui.progress($("#" + chartId).parent(), false); // data 요청 전 로딩 ui 종료

                //    return; // PCA 실행 후 일반 차트 실행 방지
                //}

                //else {
                //    // 일반 차트(이미지)
                //    $('#' + chartId).attr('src', result.chart_url).css('opacity', 1);
                //    kendo.ui.progress($("#" + chartId).parent(), false); // data 요청 전 로딩 ui 종료
                //}

            } catch (error) {
                kendo.ui.progress($("#" + chartId), false); // data 요청 전 로딩 ui 종료
                Alert.alert("error", `이미지 로드에 실패했습니다. ${error.message ? str("\n에러 메시지") + error.message : ""}`);
                console.error("이미지 로드 중 오류 발생:", error.message);
            }
        }

        // csv file 업로드 popup
        openDataUploadPopup(data) {
            let _this = this;
            let windowWidth = 700;
            let windowHeight = 570;
            //let windowWidth = window.innerWidth * 0.5;
            //let windowHeight = window.innerHeight * 0.7;

            const options = {
                title: data ? 'csv data 기반 모델 수정' : 'csv data 기반 모델 생성',
                width: `${windowWidth}px`,
                height: `${windowHeight}px`,
                param: {
                    data: data ? data : null,
                    mm_id: _this.mm_id ? _this.mm_id : null,
                    md_id: _this.md_id ? _this.md_id : null
                },
                closeCallback: function (pop_data) {
                    if (!pop_data) return;
                    if (pop_data.success) {
                        console.log("부모 원본 데이터", data);
                        console.log("팝업한테서 온 데이터", pop_data);
                        //let new_md_id = data.success.md_id;
                        _this.md_id = pop_data.md_id;
                        // 모델 저장or수정에 성공하면 file > db 변환(업로드된 파일이 변경되었을 때만)
                        if (!data || data.file_id != pop_data.new_file_id) {
                            _this.makeDbFromFile();
                        }
                        Notify.success('저장되었습니다.');
                        _this.modelGrid.grid.expandOn = true;
                        _this.searchMainData();
                        _this.renderGrid("data_detail_grid", "ds_rows_list");
                        _this.controlButtonState();
                    } else {
                        Alert.alert('error', '저장 실패');
                    }
                }
            }
            popupComn.openPopup('/page/popup/modalModel', options);

            //let _this = this;
            //let templateHtml = $('#fileUploadTemplate').html();
            //let $popup = $(templateHtml);
            //// 브라우저 너비의 50%를 팝업 너비로 설정
            //let windowWidth = window.innerWidth * 0.5;
            //let title = 'csv data 기반 모델 생성';

            //let $form = $popup.find('#dsDataForm');

            //if (data) {
            //    title = 'csv data 기반 모델 수정';
            //    FormUtil.BindDataForm(data, $form);
            //}

            //$popup.kendoWindow({
            //    width: `${windowWidth}px`,  // 가변적인 너비 설정
            //    height: "auto",
            //    title: title,
            //    visible: false,
            //    actions: ["Close"],
            //    close: function () {
            //        /* 팝업 닫을 때 필요한 로직 */
            //        // 조건 넣으면 좋을 거 같긴 한데. 만약 file_item이 null이 아니면
            //        // 업로드된 파일의 데이터를 table로 이식.
            //        // 필수 param: md_id(또는 mm_id), name, (이하 선택) type, description
            //        //_this.saveDsModel();

            //        // 팝업 닫을 때 destroy --> destroy하지 않으면 다시 open했을 때 file영역이 렌더링 되지 않음
            //        this.destroy();
            //    }
            //});

            //$popup.data("kendoWindow").center().open();

            //// 📌 기존 업로더 유지 (이미 존재하면 새로 생성하지 않음)

            //window.fileUploaderInstance = new FileUploadPage($('#da_file_area'), {
            //    placeholder: '',
            //    extensions: ['.csv'],       // 확장자
            //    tableName: 'ds_model',      // 테이블명
            //    attachName: 'attach_data',
            //    others: 'ai\\learning_data',// path
            //    dataPk: data? data.id : -1,               // 해당 테이블의 dataPk
            //    height: '100px',
            //    width: '100%',
            //    maxFilesCount: 1,           // 최대 파일 개수
            //    maxFileSize: 2000,          // 최대 용량
            //    allowedDuple: true
            //});

            //console.log(" window.fileUploaderInstance", window.fileUploaderInstance);

            //$popup.find('#Name').kendoTextBox();
            //$popup.find('#Type').kendoTextBox();
            //$popup.find('#Description').kendoTextArea({
            //    rows: 2,
            //    maxLength: 200,
            //    placeholder: ""
            //});

            //$popup.find('#btnSaveModalData').kendoButton({
            //    themeColor: "info",
            //    click: function () {
            //        Alert.confirm("",
            //            "저장하시겠습니까?",
            //            function () {
            //                const fileIds = _this.getUploadedFileIds();
            //                _this.saveDsModel($form, $popup.data("kendoWindow"), fileIds);
            //                _this.makeDbFromFile();
            //                _this.renderGrid("data_detail_grid", "ds_rows_list");
            //            },
            //            function () { }
            //        );
            //    }
            //});

            //$popup.find('#btnCloseModal').kendoButton({
            //    themeColor: "base",
            //    click: function () {
            //        $popup.data('kendoWindow').close();
            //    }
            //});
        }

        // 업로드된 fileId 가져오기
        getUploadedFileIds() {
            if (window.fileUploaderInstance) {
                // 📌 업로드된 모든 파일의 fileId를 가져옴
                const fileIds = Object.values(window.fileUploaderInstance.fileMap).map(file => file.id);
                console.log("업로드된 fileId 목록:", fileIds);
                return fileIds;
            } else {
                console.log("파일 업로더가 초기화되지 않음");
                return [];
            }
        }

        getDsInfo() {
            let _this = this;
            let url = _this.baseUrl;
            let param = {
                action: 'ds_model_info',
                md_id: _this.md_id,
            };

            let result = AjaxUtil.getSyncData(url, param);
            return result
        }

        makeDbFromFile() {
            let _this = this;
            let url = _this.baseUrl;
            let param = {
                action: 'make_db_from_file',
                md_id: _this.md_id,
            };

            let result = AjaxUtil.getSyncData(url, param);
            console.log('makeDbFromFile url, param, result', url, param, result);

            if (result.success) {
                console.log('DB생성.');
            } else {
                Alert.alert('error', 'file -> DB 변환 실패');
            }
        }

        gatherTagData() {
            let _this = this;
            let url = _this.baseUrl;

            // 모델에 저장된 수집시간과 현재 수집시간 일치 여부 확인
            let savedData = _this.getDsInfo();
            let nowStartTime = $('#StartedAt').val();
            let nowEndTime = $('#EndedAt').val();

            console.log(`prevData_start: ${savedData.StartedAt}, prevData_start: ${savedData.EndedAt}`)
            console.log(`nowStartTime: ${nowStartTime}, nowEndTime: ${nowEndTime}`);

            if (savedData.StartedAt != nowStartTime || savedData.EndedAt != nowEndTime) {
                Alert.alert('error', '모델에 저장된 수집일시와 현재 설정된 수집일시가 다릅니다. 먼저 저장하신 후 진행해주세요.');
                return;
            }

            // 백단 작업중
            let param = {
                action: 'gather_tag_data',
                md_id: _this.md_id,
                equ_id: _this.equ_id,
                startDt: savedData.StartedAt,
                endDt: savedData.EndedAt
            };

            let result = AjaxUtil.getSyncData(url, param);
            //console.log('gather_tag_data url, param, result', url, param, result);

            //if (result.success) {
            //    Notify.success('저장되었습니다');
            //} else {
            //    Alert.alert('error', `데이터 통합 실패: ${result.error}`);
            //}

            // 임시로 넣어둠
            Notify.success('저장되었습니다');
        }

        searchMainData() {
            let _this = this;
            let param = {
                action: 'ds_model_tree_list',
                equ_id: $('#cboEqu').val(),
                master_type: $('#cboModelType').val(),
                keyword: $('#sch_keyword').val(),
                islearn: $('#chk_learn').is(':checked') ? 'Y' : 'N',
            };

            kendo.ui.progress($("#model_grid"), true); // data 요청 전 로딩 ui 시작

            let succFunc = function (result) {
                console.log("result", result);

                // table union 과정에서 id의 고유성이 보장되지 않을 수 있어서 tree용 id를 생성해줌
                // id와 parentId가 동일하면 오류 발생
                let options = {
                    id: 'tree_id',
                    parentId: 'tree_master_id',
                    fields: {
                        tree_id: { field: "tree_id", type: "string" }, // TreeGrid용 고유 ID
                        tree_master_id: { field: "tree_master_id", type: "string", nullable: true }, // TreeGrid용 부모 ID
                    }
                }

                console.log("options", options);
                _this.modelGrid.setTreeDataSource(result, options);

                console.log("✅ 현재 DataSource 데이터 확인:", _this.modelGrid.getData());

                _this.modelGrid.grid.autoFitColumn(_this.modelGrid.grid.columns);
                //_this.modelGrid.grid.autoFitColumn(_this.modelGrid.grid.columns[1]);


                //_this.modelGrid.expandAll();
                // 잡았다 요놈. 여기서 아래 에러 발생
                //Uncaught NotFoundError: Failed to execute 'replaceChild' on 'Node': The node to be replaced is not a child of this node.

                kendo.ui.progress($("#model_grid"), false); // 로딩 ui 종료
            };

            AjaxUtil.getAsyncData(_this.baseUrl, param, succFunc);
            //AjaxUtil.getAsyncData(_this.baseUrl, param, function (result) {
            //    _this.modelGrid.setData(result);
            //});
        }

        fillCategoryVars() {
            let _this = this;
            let url = _this.baseUrl;
            let param = {
                action: 'cate_col_list',
                md_id: _this.md_id,
            };
            let rows = AjaxUtil.getSyncData(url, param);
            console.log("rows", rows);

            return rows;
        }

        saveDsCol() {
            let _this = this;

            let url = _this.baseUrl + '?action=save_ds_col_preprocess';

            let grid_data = $('#ds_col_grid2').data("kendoGrid").dataSource.data();

            console.log('save_ds_col_preprocess grid_data1', grid_data);

            // 데이터 타입에 따른 결측치 처리 방식 제한
            for (let i = 0; i < grid_data.length; i++) {
                let row = grid_data[i]; // 현재 행(row) 데이터

                // 범주형 데이터(char) → mean, median 사용 금지
                if (row.CategoryCount > 0 && row.Mean == null) {
                    console.log('save_ds_col_preprocess grid_data2-1', grid_data);
                    if (row.MissingValProcess === "mean" || row.MissingValProcess === "median") {
                        console.log('save_ds_col_preprocess grid_data2-2', grid_data);
                        Alert.alert("info", `범주형 데이터(${row.VarName})는 평균(mean) 또는 중위값(median)으로 처리할 수 없습니다. 다른 방식을 선택해 주세요.`);
                        return;
                    }
                }
                // 수치형(연속형) 데이터 → mode 사용 금지
                else if (!row.CategoryCount) {
                    console.log('save_ds_col_preprocess grid_data3-1', grid_data);
                    if (row.MissingValProcess === "mode") {
                        console.log('save_ds_col_preprocess grid_data3-2', grid_data);
                        Alert.alert("info", `수치형 데이터(${row.VarName})는 최빈값(mode)으로 처리할 수 없습니다. 다른 방식을 선택해 주세요.`);
                        return;
                    }
                }
                console.log('save_ds_col_preprocess grid_data4', grid_data);
                // 수치형(이산형) 데이터는 자동으로 통과 (모든 방식 허용)
            }

            let data = {
                md_id: _this.md_id,
                Q: JSON.stringify(grid_data),
            };

            let fnSuccess = function () {
                Notify.success('저장되었습니다');
                _this.renderGrid("ds_col_grid2", "ds_col_list");
            }

            AjaxUtil.postAsyncData(url, data, fnSuccess);
        }

        saveDsColXY() {
            let _this = this;

            //let _this = this;
            let url = _this.baseUrl + '?action=save_ds_col_xy';

            let grid_data = $('#settingXy_grid').data("kendoGrid").dataSource.data();
            console.log('grid_data', grid_data);

            let yCount = 0; // Y가 선택된 개수를 체크하는 변수

            // forEach문의 경우 중간에 중지 불가.
            //grid_data.forEach(function (item) {
            for (let item of grid_data) {
                item.X = (item.X == 'true' || item.X == 1) ? 1 : 0;
                item.Y = (item.Y == 'true' || item.Y == 1) ? 1 : 0;

                // X = Y인 경우(독립변수와 종속변수가 같은 경우) 경고 메시지 출력 후 저장 중단
                if (item.X == 1 && item.Y == 1) {
                    Alert.alert('error', 'X변수와 Y변수가 같습니다. 다시 선택해주세요.');
                    return; // 🚨 저장 로직 중단
                }

                if (item.Y === 1) {
                    yCount++; // Y가 선택된 경우 개수 증가
                }
            }

            // Y가 2개 이상 선택된 경우 경고 메시지 출력 후 저장 중단
            if (yCount > 1) {
                Alert.alert('error', 'Y변수는 하나만 선택해야 합니다.');
                return; // 저장 로직 중단
            }

            let data = {
                md_id: _this.md_id,
                Q: JSON.stringify(grid_data),
            };

            let fnSuccess = function (result) {
                if (result.message) {
                    let excluded_x = result.message.non_numeric_x;
                    let excluded_y = result.message.non_numeric_y;

                    Alert.alert("info",
                        `수치형 데이터가 아닌 변수는 제외됩니다.
                        <br/>제외된 X변수: ${excluded_x ? excluded_x : '없음'}
                        <br/>제외된 Y변수: ${excluded_y ? excluded_y : '없음'}`
                    );
                }
                if (result.success) {
                    Notify.success('저장되었습니다');
                }
                _this.renderGrid("settingXy_grid", "ds_col_list");
            }
            AjaxUtil.postAsyncData(url, data, fnSuccess);
        }

        saveData() {
            let _this = this;
            //let data = FormUtil.extractForm($('#detailForm'));
            //if (checkForm($('#detailForm')) === false) return;
            AjaxUtil.postAsyncData(_this.baseUrl + '?action=save', data, (resp) => {
                if (resp.success) {
                    Notify.success('저장되었습니다.');
                    _this.searchMainData();
                } else {
                    Alert.alert('error', resp.message);
                }
            });
        }

        deleteModel() {
            let _this = this;

            console.log("_this.md_id", _this.md_id);
            if (_this.md_id) {

                AjaxUtil.postAsyncData(this.baseUrl + '?action=delete_ds_model', { md_id: _this.md_id }, (resp) => {
                    if (resp.success) {
                        Notify.success('삭제되었습니다.');
                        _this.modelGrid.grid.expandOn = true;
                        _this.searchMainData();
                        _this.renderGrid("data_detail_grid", "ds_rows_list");

                        _this.md_id = null; // 새 선택이 있기 전까지 현재 데이터가 md_id를 가지고 있게 되므로 수동 처리
                        _this.controlButtonState();
                    }
                    else {
                        Alert.alert('error', resp.message);
                    }
                });
            }
        }

        updateTrainButtons() {
            let _this = this;

            const hasTrainId = !!_this.mt_id;

            // 삭제 버튼 표시 여부 제어
            $('#btnDeleteTrain').toggle(hasTrainId);

            // 저장 버튼 텍스트 업데이트
            const $btnSave = $('#btnSaveTrain');
            const label = hasTrainId ? '수정' : '저장';
            $btnSave.find('.btn-label').text(label);

        }

        initTrainForm(formData = null, options = {}) {
            let _this = this;
            const $form = $('#modelTrainForm');
            const $btn = $('#trainBtnWrap');
            const $msg = $('#noDataMsg');

            if (!_this.md_id) {
                $form.hide();
                $btn.hide();
                $msg.show();
                return;
            }

            $form.show();
            $btn.show();
            $msg.hide();

            const isNew = options.new_check || !formData?.id;
            // 초기화 or 실패 상태에서만 수정 가능하게 해주는 플래그
            const isEditable = formData?.TrainStatus == 'INITIALIZED' || formData?.TrainStatus == 'FAILED';
            //console.log("option", widget.options);

            if (formData) {
                // 데이터 리셋 후 바인딩
                const taskType = formData?.TaskType;
                const algoType = formData?.AlgorithmType;

                // 분석유형을 기준으로 알고리즘 목록만 먼저 초기화(form바인딩시 자동으로 반영되지 않음)
                const groupCode = taskType ? `AI_${taskType}` : 'ALGORITHM_TYPE';
                AjaxUtil.fillDropDownOptions($('#AlgorithmType'), 'user_code', 'choose', algoType, groupCode);

                // 이후 전체 form 데이터 바인딩
                FormUtil.BindDataForm(formData, $form);

                const algoValue = formData?.AlgorithmType || $('#AlgorithmType').data('kendoDropDownList')?.value?.();
                if (algoValue) {
                    let paramObj = {};

                    // 하이퍼파라미터 값 주입
                    if (formData.param_list?.length) {
                        console.log("getTrainInfo로 얻어온 param_list", formData.param_list);
                        formData.param_list.forEach(p => {
                            //paramObj[p.ParamKey] = p.ParamValue;
                            paramObj[p.ParamKey] = {
                                value: p.ParamValue
                                , remark: p.Remark || '' // Remark 값을 추가
                            };
                        });
                    }

                    // 서버에 저장된 알고리즘 종류에 필요한 하이퍼파라미터 폼을 동적으로 구성
                    _this.renderHyperParamForm(algoValue, paramObj);

                } else {
                    _this.renderHyperParamForm();

                }

                _this.renderTrainStatus(formData.TrainStatus, formData.status_name);

            } else {
                FormUtil.resetForm($form);
                _this.renderHyperParamForm();
            }

            // 2. 필드 표시 제어 - 신규 저장 시에는 숨김
            $('#TrainStatusWrap').toggle(!isNew);
            $('#ApplyYNWrap').toggle(!isNew);

            // 3. 필드 비활성화 제어
            $('#TaskType').data('kendoDropDownList')?.enable(isNew || isEditable);
            $('#AlgorithmType').data('kendoDropDownList')?.enable(isNew || isEditable);

            // 4. 힌트 초기화
            $('#taskHint, #algoInfo').hide().find('span').text('');
        }

        saveTrainConfig() {
            let _this = this;

            let url = _this.baseUrl + '?action=save_ds_model_train';

            let $form = $('#modelTrainForm');
            let disabledFields = [];

            $form.find(':input:disabled').each(function () {
                let name = $(this).attr('name');
                if (name) {
                    disabledFields.push(name);
                }
            });

            //let data = FormUtil.extractForm($('#modelTrainForm'));
            let data = FormUtil.extractForm($form, disabledFields);
            data['md_id'] = _this.md_id;

            // 하이퍼파라미터 값 추가
            const hyperParamForm = $('#hyperParam').data('kendoForm');
            if (hyperParamForm) {
                const formData = hyperParamForm.options.formData;
                const hyperParams = {};

                for (let key in formData) {
                    if (data.hasOwnProperty(key)) {
                        const val = data[key];
                        if (val !== '') {
                            hyperParams[key] = val;
                        }
                        delete data[key]; // 기존 데이터에서 제거 (선택)
                    }
                }

                data['hyperParams'] = JSON.stringify(hyperParams);
            }

            console.log('train form data', data);

            if (checkForm($('#modelTrainForm')) === false) return;

            let fnSuccess = function (resp) {
                if (resp.success) {
                    Notify.success('저장되었습니다.');
                    _this.mt_id = resp.mt_id;
                    _this.modelGrid.grid.expandOn = true;
                    _this.searchMainData();
                    
                    // 저장후 form 정보 갱신
                    const formData = _this.getTrainInfo();
                    _this.initTrainForm(formData);  // 저장 직후는 무조건 기존 정보 → new_check 필요 없음
                    _this.renderGrid("model_score_grid", "model_metric_list", { mt_id: _this.mt_id });
                    _this.updateTrainButtons();

                } else {
                    Alert.alert('error', resp.message);
                }
            }

            AjaxUtil.postAsyncData(url, data, fnSuccess);
        }

        getTrainInfo() {
            let _this = this;
            let url = _this.baseUrl;
            let param = {
                action: 'ds_train_info',
                mt_id: _this.mt_id,
            };

            let result = AjaxUtil.getSyncData(url, param);
            console.log("train_result", result);

            return result
        }

        renderHyperParamForm(algoCode, presetParams = {}) {
            const $formContainer = $('#hyperParam');
            const $formWrap = $('#hyperParamWrap');

            // 1. 숨김 처리 및 초기화
            $formWrap.hide();
            $formContainer.empty();

            if (!algoCode) return;
            //console.log("presetParams", presetParams);

            // 2. 서버에서 파라미터 정의 가져오기
            const params = AjaxUtil.getSelectData('user_code', algoCode);
            //console.log("algoCode로 얻어온 params", params);

            if (!Array.isArray(params) || !params.length) return;

            // 3. formData 구성 (presetParams에 값이 있으면 바인딩)
            const formData = {};
            params.forEach(p => {
                const key = p.value; // ex) "RANDOM_STATE"
                //formData[key] = presetParams?.[key] ?? '';
                formData[key] = presetParams[key]?.value || ''; // presetParams에서 값 가져오기
                p.param_desc = presetParams[key]?.remark || p.param_desc; // presetParams에서 Remark 가져오기
            });

            // 4. 폼 항목 구성
            const items = params.map(p => ({
                field: p.value,
                label: p.value.toLowerCase(),
                editor: "TextBox",
                editorOptions: {
                    placeholder: p.param_desc || '' // Remark 값을 placeholder로 설정
                }
            }));

            //console.log("formData", formData);
            //console.log("items", items);

            // 5. 기존 kendoForm 제거
            const existing = $formContainer.data('kendoForm');
            if (existing) {
                existing.destroy();
                $formContainer.empty();
            }

            // 6. 컨테이너 비우고 새 폼 생성
            $formContainer.kendoForm({
                formData: formData,
                items: items,
                buttonsTemplate: "" // 자동으로 생성되는 버튼 방지
            });

            // 7. 생성 후 각 필드에 수동 값 주입 (보장용)
            const newForm = $formContainer.data('kendoForm');

            if (newForm && typeof newForm.options.formData === 'object') {
                for (const key in formData) {
                    const input = $formContainer.find(`[name="${key}"]`);
                    if (input.length) input.val(formData[key]);
                }
            }
            console.log("kendoForm new 객체 찍어보기", newForm);

            // 8. 생성된 후 .k-form 요소에 동적 생성 form 클래스 & border style class 추가
            //$('#hyperParam').closest('.k-form').addClass('form-dynamic k-rounded-md');
            $formContainer.closest('.k-form').addClass('form-dynamic k-rounded-md');
            $formWrap.show();

            //$('#hyperParam').find('input').each(function () {
            $formContainer.find('input').each(function () {
                console.log($(this).attr('name'), $(this).val());
            });
        }

        // 학습 상태에 따른 icon & 버튼 상태 바인딩
        renderTrainStatus(statusCode, statusName) {
            const $wrap = $('#TrainStatusWrap');
            const $display = $('#statusDisplay');

            const iconMap = {
                INITIALIZED: 'inventory',   // 저장됨
                PENDING: 'schedule',        // 회전 아이콘
                TRAINING: 'autorenew',      // 취소
                COMPLETED: 'check_circle',  // 체크
                FAILED: 'error'             // 에러 느낌
            };

            const colorMap = {
                INITIALIZED: 'color: #6c757d',   // inventory → 회색빛, 기본 저장 상태
                PENDING: 'color: #17a2b8',       // schedule → 파란톤 대기
                TRAINING: 'color: #ffc107',      // autorenew → 노란색, 동작 중 느낌
                COMPLETED: 'color: #28a745',     // check_circle → 초록색 성공
                FAILED: 'color: #dc3545'         // error → 붉은색 실패
            };

            const icon = iconMap[statusCode] || 'help';
            const color = colorMap[statusCode] || 'color: #aaa';

            $display.html(`
                <i class="material-symbols-outlined" style="${color}; vertical-align: middle; margin-right: 3px;">
                    ${icon}
                </i>
                <span style="vertical-align: middle; margin-right: 20px;">${statusName}</span>
            `);

            $wrap.show();
        }

        deleteTrainConfig() {
            let _this = this;

            if (_this.mt_id) {
                AjaxUtil.postAsyncData(this.baseUrl + '?action=delete_ds_model_train',
                    { mt_id: _this.mt_id }, (resp) => {
                        if (resp.success) {
                            Notify.success('삭제되었습니다.');
                            _this.modelGrid.grid.expandOn = true;
                            _this.searchMainData();
                            _this.mt_id = null;
                            _this.initTrainForm();
                        } else {
                            Alert.alert('error', resp.message);
                        }
                    });
            }
        }

        startTrain() {
            let _this = this;
            if (_this.mt_id) {
                kendo.ui.progress($("#model_result"), true); // data 요청 전 로딩 ui 시작

                AjaxUtil.postAsyncData(this.baseUrl + '?action=start_learning', { mt_id: _this.mt_id }, (resp) => {
                    if (resp.success) {
                        Notify.success('모델 학습을 요청했습니다.');
                        _this.modelGrid.grid.expandOn = true;
                        _this.searchMainData();
                        const formData = _this.getTrainInfo();
                        _this.initTrainForm(formData);

                        //나중엔 분리해야함
                        $('#' + 'model_pred_chart').html(resp.pca_plotly);
                        _this.syncImageWithLink('model_tree_chart', resp.tree_chart_url);
                        _this.syncImageWithLink('model_feat_chart', resp.feat_chart_url);
                        _this.syncImageWithLink('train_score_chart', resp.roc_train_chart_url);
                        _this.syncImageWithLink('test_score_chart', resp.roc_test_chart_url);
                        _this.renderGrid("model_score_grid", "model_metric_list", { mt_id: _this.mt_id });

                        if (resp.unsupported_message) {
                            Alert.alert('info', resp.unsupported_message);
                        }

                    } else {
                        Alert.alert('error', resp.message);
                    }

                    kendo.ui.progress($("#model_result"), false); // data 로딩 ui 종료

                });
            }
        }

        syncImageWithLink(id, src) {
            const $img = $('#' + id).attr('src', src).css('opacity', 1);
            const $link = $img.closest('a');
            if ($link.length) {
                $link.attr('href', src);
            }
        }

    }

    let page = new DataSciencePage();

    $(document).ready(function () {
        //page.searchMainData();
    });
</script>
{% endblock %}
