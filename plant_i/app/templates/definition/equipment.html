{% extends "app/layout.html" %}
{% block css %}
{% endblock %}

{% block content %}
<div class="content-wrap">
    <div class="content-ui-row">
        <form class="search-form" id="searchForm">
            <div class="card-content search">
                <!-- 개발자 수동 적용, grid-template-columns:1fr 1fr 1fr auto  -->
                <div class="form-ui">
                    <div class="col-auto">
                        <div class="form-item align-h">
                            <label class="k-label k-form-label" for="srch_equ_line" data-labelCd="라인">라인</label>
                            <div class="field-wrapper">
                                <select id="srch_equ_line" name="srch_equ_line"></select>
                            </div>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-item align-h">
                            <label class="k-label k-form-label" for="srch_equ_grp" data-labelCd="설비그룹">설비그룹</label>
                            <div class="field-wrapper">
                                <select id="srch_equ_grp" name="srch_equ_grp"></select>
                            </div>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-item align-h">
                            <label class="k-label k-form-label" for="srch_equ_name" data-labelCd="설비명">설비명</label>
                            <div class="field-wrapper">
                                <input id="srch_equ_name" name="srch_equ_name" />
                            </div>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="card-group-btn search">
                            <button id="btnSearch" class="btn-search">조회</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <div class="content-ui-row connect">
            <div class="card-content grid">
                <div class="card-group-btn">
                    <span class="info-text">
                        <i class="material-symbols-outlined">list_alt</i>
                        <label data-labelCd="설비정보">설비정보</label>
                    </span>
                    <span>
                    </span>
                    <span>
                        <!-- 오른쪽 버튼 영역-->
                        <button id="btnExcel">Excel</button>
                    </span>
                </div>
                <div id="equipment_grid"></div>
            </div>
        </div>
        <div class="content-ui-row connect">
            <div class="card-content edit">
                <div class="card-group-btn">
                    <span class="info-text"><i class="material-symbols-outlined">edit_square</i>입력</span>
                    <span>
                        <button id="btnClear"><i class="material-symbols-outlined">refresh</i>초기화</button>
                        <button id="btnSave"><i class="material-symbols-outlined">save</i>저장</button>
                        <button id="btnDelete"><i class="material-symbols-outlined">delete</i>삭제</button>
                    </span>
                </div>

                <form id="equipmentForm">
                    <div class="edit-form-ui">
                        <!-- id -->
                        <input type="hidden" id="id" name="id" />
                        <!-- 기본 정보 -->
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Line_id" data-labelCd="라인">라인</label>
                                <div class="field-wrapper">
                                    <select id="Line_id" name="Line_id"></select>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="EquipmentGroup_id" data-labelCd="설비그룹">설비그룹</label>
                                <div class="field-wrapper">
                                    <select id="EquipmentGroup_id" name="EquipmentGroup_id"></select>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label essential" for="Code" data-labelCd="설비코드">설비코드</label>
                                <div class="field-wrapper">
                                    <input id="Code" name="Code" data-msg="설비코드를" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label essential" for="Name" data-labelCd="설비명">설비명</label>
                                <div class="field-wrapper">
                                    <input id="Name" name="Name" data-msg="설비명을" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="input-container">
                                <label for="설비위치">설비위치</label>
                                <input type="text" id="설비위치" class="k-textbox" />
                                <button id="addButton" class="k-button k-primary">
                                    <span class="k-icon k-i-plus"></span>
                                    추가
                                </button>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="MESCode" data-labelCd="MES설비코드">MES설비코드</label>
                                <div class="field-wrapper">
                                    <input id="MESCode" name="MESCode" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="SAPCode" data-labelCd="SAP설비코드">SAP설비코드</label>
                                <div class="field-wrapper">
                                    <input id="SAPCode" name="SAPCode" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Usage" data-labelCd="용도">용도</label>
                                <div class="field-wrapper">
                                    <input id="Usage" name="Usage" />
                                </div>
                            </div>
                        </div>

                        <!-- 제조 정보 -->
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Maker" data-labelCd="제조사">제조사</label>
                                <div class="field-wrapper">
                                    <input id="Maker" name="Maker" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Model" data-labelCd="모델명">모델명</label>
                                <div class="field-wrapper">
                                    <input id="Model" name="Model" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Standard" data-labelCd="규격">규격</label>
                                <div class="field-wrapper">
                                    <input id="Standard" name="Standard" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="SerialNumber" data-labelCd="시리얼넘버">시리얼넘버</label>
                                <div class="field-wrapper">
                                    <input id="SerialNumber" name="SerialNumber" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="ProductionYear" data-labelCd="제작연도">제작연도</label>
                                <div class="field-wrapper">
                                    <input id="ProductionYear" name="ProductionYear" type="number" />
                                </div>
                            </div>
                        </div>

                        <!-- 구매 및 설치 정보 -->
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="PurchaseDate" data-labelCd="구매일">구매일</label>
                                <div class="field-wrapper">
                                    <input id="PurchaseDate" name="PurchaseDate" type="date" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="PurchaseCost" data-labelCd="구매금액(원)">구매금액(원)</label>
                                <div class="field-wrapper">
                                    <input id="PurchaseCost" name="PurchaseCost" type="number" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="SupplierName" data-labelCd="공급업체">공급업체</label>
                                <div class="field-wrapper">
                                    <input id="SupplierName" name="SupplierName" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Inputdate" data-labelCd="입고일">입고일</label>
                                <div class="field-wrapper">
                                    <input id="Inputdate" name="Inputdate" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="InstallDate" data-labelCd="설치일">설치일</label>
                                <div class="field-wrapper">
                                    <input id="InstallDate" name="InstallDate" type="date" />
                                </div>
                            </div>
                        </div>

                        <!-- 운영 및 관리 정보 -->
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="ManageNumber" data-labelCd="관리번호">관리번호</label>
                                <div class="field-wrapper">
                                    <input id="ManageNumber" name="ManageNumber" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="AssetYN" data-labelCd="자산여부">자산여부</label>
                                <div class="field-wrapper">
                                    <input id="AssetYN" name="AssetYN" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="DurableYears" data-labelCd="내용연수">내용연수</label>
                                <div class="field-wrapper">
                                    <input id="DurableYears" name="DurableYears" type="number" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="PowerWatt" data-labelCd="소비전력(W)">소비전력(W)</label>
                                <div class="field-wrapper">
                                    <input id="PowerWatt" name="PowerWatt" type="number" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Voltage" data-labelCd="사용전압">사용전압</label>
                                <div class="field-wrapper">
                                    <input id="Voltage" name="Voltage" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Status" data-labelCd="설비상태">설비상태</label>
                                <div class="field-wrapper">
                                    <select id="Status" name="Status"></select>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Depart_id" data-labelCd="관리부서">관리부서</label>
                                <div class="field-wrapper">
                                    <select id="Depart_id" name="Depart_id"></select>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Manager" data-labelCd="관리책임자">관리책임자</label>
                                <div class="field-wrapper">
                                    <input id="Manager" name="Manager" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="ServiceCharger" data-labelCd="서비스담당자">서비스담당자</label>
                                <div class="field-wrapper">
                                    <input id="ServiceCharger" name="ServiceCharger" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="ASTelNumber" data-labelCd="AS전화번호">AS전화번호</label>
                                <div class="field-wrapper">
                                    <input id="ASTelNumber" name="ASTelNumber" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="OperationRateYN" data-labelCd="가동률 표시여부">가동률 표시여부</label>
                                <div class="field-wrapper">
                                    <input id="OperationRateYN" name="OperationRateYN" />
                                </div>
                            </div>
                        </div>

                        <!-- 폐기 정보 -->
                        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="DisposalDate" data-labelCd="폐기일">폐기일</label>
                                <div class="field-wrapper">
                                    <input id="DisposalDate" name="DisposalDate" type="date" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="DisposalReason" data-labelCd="폐기사유">폐기사유</label>
                                <div class="field-wrapper">
                                    <textarea id="DisposalReason" name="DisposalReason"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- 설명란 -->
                        <div class="col-12">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="Description" data-labelCd="설명">설명</label>
                                <div class="field-wrapper">
                                    <textarea id="Description" name="Description"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="AttentionRemark" data-labelCd="주의사항">주의사항</label>
                                <div class="field-wrapper">
                                    <textarea id="AttentionRemark" name="AttentionRemark"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-item align-h">
                                <label class="k-label k-form-label" for="file_area" data-labelCd="첨부파일">첨부파일</label>
                                <div class="field-wrapper">
                                    <div id="file_area" name="file_area"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </form>

            </div>
        </div>
        <div id="modalWindow" class="modal">
            <div class="modal-content">
                <h4>설비위치 정보 등록</h4>
                
                <div class="form-section">
                    <!-- 입력 폼 영역 -->
                    <div class="form-row">
                        <div class="form-group col-6">
                            <label>위치코드<span class="required">*</span></label>
                            <input type="text" class="form-control" placeholder="50자 이하로 입력하세요" />
                        </div>
                        <div class="form-group col-6">
                            <label>위치명<span class="required">*</span></label>
                            <input type="text" class="form-control" placeholder="50자 이하로 입력하세요" />
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-6">
                            <label>상위위치</label>
                            <select class="form-control">
                                <option>위치1</option>
                                <option>위치2</option>
                            </select>
                        </div>
                        <div class="form-group col-6">
                            <label>상태<span class="required">*</span></label>
                            <select class="form-control">
                                <option>작동중</option>
                                <option>정지</option>
                            </select>
                        </div>
                    </div>

                    <!-- Yes/No 버튼 그룹 -->
                    <div class="form-row yn-buttons-row">
                        <div class="yn-button-group">
                            <label>공장여부</label>
                            <div class="btn-group">
                                <button type="button" class="btn btn-toggle" data-value="Yes">Yes</button>
                                <button type="button" class="btn btn-toggle active" data-value="No">No</button>
                            </div>
                        </div>
                        <div class="yn-button-group">
                            <label>건물여부</label>
                            <div class="btn-group">
                                <button type="button" class="btn btn-toggle" data-value="Yes">Yes</button>
                                <button type="button" class="btn btn-toggle active" data-value="No">No</button>
                            </div>
                        </div>
                        <div class="yn-button-group">
                            <label>보전재재고여부</label>
                            <div class="btn-group">
                                <button type="button" class="btn btn-toggle" data-value="Yes">Yes</button>
                                <button type="button" class="btn btn-toggle active" data-value="No">No</button>
                            </div>
                        </div>
                    </div>

                    <!-- 그리드 영역 -->
                    <div class="grid-section">
                        <h3>최근 등록된 설비위치</h3>
                        <div id="recentLocationsGrid"></div>
                    </div>
                </div>

                <!-- 버튼 영역 -->
                <div class="modal-footer">                   
                    <button id="btnSave" title="저장"><i class="material-symbols-outlined">save</i>저장</button>
                    <button id="closeModal" title="닫기"><i class="material-symbols-outlined">close</i>닫기</button>
                </div>
            </div>
        </div>
    </div>

</div>

<style>
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 800px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .form-item {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .radio-group {
        display: flex;
        gap: 15px; /* 라디오 버튼 간 간격 */
    }

    .radio-group label {
        display: flex;
        align-items: center;
        gap: 5px; /* 버튼과 텍스트 간 간격 */
    }

    .radio-group-wrapper {
        display: flex;
        gap: 20px;
        align-items: center;
    }

    .radio-group-wrapper span {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .k-radio-label {
        margin-left: 4px;
        cursor: pointer;
    }

    .btn-group {
        display: flex;
        gap: 4px;
    }

    .btn-toggle {
        padding: 6px 16px;
        border: 1px solid #ddd;
        background: white;
        color: #666;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.2s;
    }

    .btn-toggle:hover {
        background: #f8f9fa;
    }

    .btn-toggle.active {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }

    .recent-locations {
        margin-top: 20px;
        border-top: 1px solid #ddd;
        padding-top: 20px;
    }

    .recent-locations h3 {
        font-size: 16px;
        margin-bottom: 10px;
        color: #333;
    }

    #recentLocationsGrid {
        border: 1px solid #e0e0e0;
        margin-top: 10px;
    }

    .k-grid-header th {
        background-color: #f5f5f5;
        font-weight: bold;
    }

    .k-grid td {
        border-bottom: 1px solid #e0e0e0;
        padding: 8px;
    }

    .k-grid tr:hover {
        background-color: #f8f9fa;
    }

    .yn-buttons-row {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
    }

    .yn-button-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .yn-button-group label {
        margin: 0;
        white-space: nowrap;
        min-width: fit-content;
    }

    .btn-group {
        display: flex;
        gap: 5px;
    }

    .btn-toggle {
        padding: 4px 12px;
        border: 1px solid #ddd;
        background: white;
        cursor: pointer;
        border-radius: 4px;
    }

    .btn-toggle.active {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }

    .grid-section {
        margin-top: 20px;
        border-top: 1px solid #ddd;
        padding-top: 20px;
    }

    .grid-section h3 {
        font-size: 14px;
        margin-bottom: 10px;
        color: #333;
    }

    #recentLocationsGrid {
        height: 200px;
        border: 1px solid #ddd;
    }

    .modal-content {
        max-width: 800px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .form-section {
        padding: 20px;
    }

    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
    }

    .form-group {
        flex: 1;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
    }

    .required {
        color: #ff0000;
        margin-left: 4px;
    }

    .form-control {
        width: 100%;
        height: 38px;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .yn-buttons-row {
        margin-top: 20px;
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .yn-button-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .yn-button-group label {
        margin: 0;
        white-space: nowrap;
    }

    .input-container {
        display: flex;
        align-items: center;
        gap: 10px;  /* 요소들 사이 간격 */
    }
    
    .input-container label {
        white-space: nowrap;  /* 라벨 텍스트 줄바꿈 방지 */
        margin-bottom: 0;     /* 기본 마진 제거 */
    }
    
    .input-container .k-textbox {
        width: 200px;
        flex: 0 0 auto;
    }

</style>

    {% verbatim %}
    {% endverbatim %}
    {% endblock %}

    {% block scripts %}
    {% include 'common/file_upload.html' %}

<script type="text/javascript">
    class EquipmentPage {
        constructor() {
            this.grid = null;
            this.upload = null;
            this.baseUrl = '/api/definition/equipment';

            this.init();
        }

        init() {
            let _this = this;
            let equipmentGridOption = {
                toolbar: [
                    "columns"
                ],
                columnMenu: {
                    componentType: "classic",
                    autoSize: true,
                    clearAllFilters: true,
                    columns: {
                        sort: "asc",
                    }
                },
                columns: [
                    // 기본 정보
                    { field: 'line_name', title: '라인', width: 150 },
                    { field: 'group_name', title: '설비그룹', width: 150 },
                    { field: 'Code', title: '설비코드', width: 150 },
                    { field: 'Name', title: '설비명', width: 200 },
                    { field: 'MESCode', title: 'MES코드', width: 150 },
                    { field: 'SAPCode', title: 'SAP코드', width: 150 },
                    { field: 'Description', title: '설명', width: 250 },
                    { field: 'Usage', title: '용도', width: 150 },

                    // 제조 정보
                    { field: 'Maker', title: '제조사', width: 150 },
                    { field: 'Model', title: '모델명', width: 150 },
                    { field: 'Standard', title: '규격', width: 150 },
                    { field: 'SerialNumber', title: '시리얼넘버', width: 150 },
                    { field: 'ProductionYear', title: '제작연도', width: 150 },

                    // 구매 및 설치 정보
                    { field: 'PurchaseDate', title: '구매일', width: 150 },
                    { field: 'PurchaseCost', title: '구매가', width: 150 /*formatter: 'money'*/ },
                    { field: 'SupplierName', title: '공급업체', width: 150 },
                    { field: 'Inputdate', title: '입고일', width: 150 },
                    { field: 'InstallDate', title: '설치일', width: 150 },

                    // 운영 및 관리 정보
                    { field: 'ManageNumber', title: '관리번호', width: 200 },
                    { field: 'AssetYN', title: '자산성여부', width: 100 },
                    { field: 'DurableYears', title: '내용연수', width: 150 },
                    { field: 'PowerWatt', title: '소비전력(W)', width: 150 },
                    { field: 'Voltage', title: '사용전압', width: 150 },
                    { field: 'Status', title: '설비상태', width: 150 },
                    { field: 'depart_Name', title: '관리부서', width: 150 },
                    { field: 'Manager', title: '관리책임자', width: 150 },
                    { field: 'AttentionRemark', title: '주의사항', width: 250 },
                    { field: 'ServiceCharger', title: '서비스담당자', width: 150 },
                    { field: 'ASTelNumber', title: 'AS전화번호', width: 150 },
                    { field: 'OperationRateYN', title: '가동률표시YN', width: 100 },

                    // 폐기 정보
                    { field: 'DisposalDate', title: '폐기일', width: 150 },
                    { field: 'DisposalReason', title: '폐기사유', width: 200 },
                ],

                change: function (e) {
                    _this.showDetail();
                },
                dataBound: function (e) {
                    for (var i = 0; i < this.columns.length; i++) {
                        this.autoFitColumn(i);
                    };

                    // grid 데이터 개수 표시
                    kendoUtil.showGridRowCount(this.element);
                },
                height: "540px"
            };
            _this.grid = new Grid($("#equipment_grid"), equipmentGridOption);

            //search form
            //combo 데이터 가져와서 요소에 바로 채우기(선택자, combo_type, null_option, selected_value)
            AjaxUtil.fillDropDownOptions($('#srch_equ_line'), 'line', 'all', null);
            AjaxUtil.fillDropDownOptions($('#srch_equ_grp'), 'equipment_group', 'all', null);
            //AjaxUtil.fillDropDownOptions($('#srch_workcenter'), 'workcenter', 'all', null);
            $('#srch_equ_name').kendoTextBox();
            $('#srch_equ_name').keypress(function (e) {
                // Enter(=13)키가 눌렸을 때, 기본 동작 방지 후 searchMainData 호출
                if (e.keyCode === 13) {
                    e.preventDefault();
                    _this.searchMainData();
                }
            });

            //detail form
            AjaxUtil.fillDropDownOptions($('#Line_id'), 'line', 'choose', null);
            AjaxUtil.fillDropDownOptions($('#EquipmentGroup_id'), 'equipment_group', 'choose', null);
            $('#Code').kendoTextBox();
            $('#Name').kendoTextBox();
            $('#MESCode').kendoTextBox();
            $('#SAPCode').kendoTextBox();
            $('#ManageNumber').kendoTextBox();
            //AjaxUtil.fillDropDownOptions($('#WorkCenter_id'), 'workcenter', 'choose', null);
            $('#Model').kendoTextBox();
            $('#Maker').kendoTextBox();
            $('#SerialNumber').kendoTextBox();
            $('#ProductionYear').kendoTextBox();
            $('#PurchaseDate').kendoDatePicker({ format: 'yyyy-MM-dd' });
            //$('#Inputdate').kendoDatePicker({ format: 'yyyy-MM-dd' });
            $('#Inputdate').kendoTextBox();
            $('#InstallDate').kendoDatePicker({ format: 'yyyy-MM-dd' });
            $('#SupplierName').kendoTextBox();
            $('#PurchaseCost').kendoTextBox();
            $('#OperationRateYN').kendoSwitch({
                checked: true
            });
            $('#DisposalDate').kendoDatePicker({ format: 'yyyy-MM-dd' });
            $('#Manager').kendoTextBox();
            AjaxUtil.fillDropDownOptions($('#Depart_id'), 'depart', 'choose', null); // 관리부서 드롭다운
            $('#Usage').kendoTextBox(); // 용도
            $('#Standard').kendoTextBox(); // 규격
            $('#AssetYN').kendoSwitch({
                checked: true
            });
            $('#DurableYears').kendoNumericTextBox({
                format: 'n0',
            });
            $('#PowerWatt').kendoNumericTextBox({
                format: 'n2',
            });
            $('#Voltage').kendoTextBox(); // 사용전압
            $('#Status').kendoDropDownList({
                // 예시구문.
                dataSource: [
                    { text: '정상', value: 'normal' },
                    { text: '고장', value: 'fault' },
                    { text: '유지보수', value: 'maintenance' }
                ],
                optionLabel: '선택',
                dataTextField: 'text',
                dataValueField: 'value'
            });
            $('#ServiceCharger').kendoTextBox(); // 서비스담당자
            $('#ASTelNumber').kendoMaskedTextBox({
                mask: '(000) 0000-0000' // 전화번호 포맷
            }); // AS전화번호
            $('#DisposalReason').kendoTextArea({
                rows: 3,
                autosize: true,
                maxLength: 500,
            });
            $('#AttentionRemark').kendoTextArea({
                rows: 3,
                autosize: true,
                maxLength: 500,
            });
            $('#Description').kendoTextArea({
                rows: 3,
                autosize: true,
                maxLength: 500,
            });

            //slide uploader
            // 24.11.27. 김하늘 우선 주석처리
            //드래그로 파일 업로드시 업로드 불가 & file이 업로드 후에도 계속 화면에 보임
            //_this.upload = new FileUploadPage($('#file_area'), {
            //    placeholder: 'DRAG & DROP', // 업로드 박스 안내문
            //    extensions: ['.jpg', '.png', '.xlsx', 'pdf'], // 허용 가능 확장자
            //    tableName: 'equipment',
            //    attachName: 'attach_doc',
            //    others: 'doc',
            //    dataPk: 3,
            //    height: '50px',
            //    width: '100%',
            //    maxFilesCount: 5,
            //    maxFileSize: 2000, // mb 기준
            //    allowedDuple: true // 중복허용
            //});


            //form button
            $('#btnSearch').kendoButton({
                icon: "search",
                themeColor: "base",
                click: function () {
                    _this.searchMainData();
                }
            });

            $('#btnExcel').kendoButton({
                icon: "file-excel",
                themeColor: "success",
                click: function () {
                    _this.grid.grid.saveExcel();
                }
            });

            $('#btnClear').kendoButton({
                themeColor: "base", click: function () {
                    _this.resetData();
                }
            });
            $('#btnSave').kendoButton({
                themeColor: "info",
                click: function () {
                    _this.saveData();
                }
            });
            $('#btnDelete').kendoButton({
                themeColor: "error",
                click: function () {
                    _this.deleteData();
                }
            });

        }

        searchMainData() {
            let _this = this;

            let param = {
                action: 'read',
                line: $('#srch_equ_line').val(),
                group: $('#srch_equ_grp').val(),
                equipment: $('#srch_equ_name').val(),
            };

            let result = AjaxUtil.getSyncData(_this.baseUrl, param);
            _this.grid.setData(result);
        }

        resetData() {
            let _this = this;
            $("#equipment_grid").data('kendoGrid').refresh();
            FormUtil.resetForm($('#equipmentForm'));
        }

        showDetail() {
            let _this = this;
            let data = _this.grid.getSelect();
            if (data.length > 0) {
                let selectData = data[0];
                FormUtil.BindDataForm(selectData, $('#equipmentForm'));
                console.log("selectData:\n", selectData);
            }
        }

        saveData() {
            let _this = this;
            let data = FormUtil.extractForm($('#equipmentForm'));
            data.OperationRateYN = $("#OperationRateYN").data("kendoSwitch").check() ? 'Y' : 'N';
            data.AssetYN = $("#OperationRateYN").data("kendoSwitch").check() ? 'Y' : 'N';

            let Code = $('#Code').val();
            let Name = $('#Name').val();

            if (!Code) {
                Alert.alert('', '설비코드를 입력해주세요.');
                return;
            } else if (!Name) {
                Alert.alert('', '설비명을 입력해주세요.');
                return;
            }

            if ($('#PurchaseCost').val() < 0) {
                Alert.alert('', '구매금액을 확인해 주세요.');
                return;
            }

            let funcSucc = function (resp) {
                if (resp.success) {
                    Notify.success('저장되었습니다.');
                    _this.searchMainData();
                } else {
                    Alert.alert('error', resp.message);
                }
            };

            AjaxUtil.postAsyncData(_this.baseUrl + '?action=save', data, funcSucc);
        }

        deleteData() {
            let _this = this;
            let data = _this.grid.getSelect();
            if (data.length > 0) {
                let selectData = data[0];
                let param = {
                    id: selectData.id
                };

                let funcSucc = function (resp) {
                    if (resp.success) {
                        Notify.success('삭제되었습니다.');
                        _this.resetData();
                        _this.searchMainData();
                    } else {
                        Alert.alert('error', resp.message);
                    }
                };
                AjaxUtil.postAsyncData(_this.baseUrl + '?action=delete', param, funcSucc);
            }
        }
    };

    let page = null;

    $(document).ready(function () {
        page = new EquipmentPage();

        page.searchMainData();

        const modal = $("#modalWindow");
        const openModalBtn = $("#btnModalOpen");
        const closeModalBtn = $("#closeModal");

        // 모달 열기
        openModalBtn.on("click", function (e) {
            e.preventDefault();
            modal.fadeIn();
        });

        // 모달 닫기 - 닫기 버튼 클릭
        closeModalBtn.on("click", function () {
            modal.fadeOut();
        });

        // 모달 닫기 - ESC 키 누를 때
        $(document).on('keydown', function(e) {
            if (e.keyCode === 27) { // ESC key
                modal.fadeOut();
            }
        });

        // 모달 외부 클릭 시 닫기
        $(window).on("click", function (e) {
            if ($(e.target).is('.modal')) {
                modal.fadeOut();
            }
        });

        // Yes/No 버튼 토글 기능
        $('.btn-group .btn-toggle').on('click', function() {
            const $btnGroup = $(this).closest('.btn-group');
            $btnGroup.find('.btn-toggle').removeClass('active');
            $(this).addClass('active');
        });

        // 그리드 초기화
        $("#recentLocationsGrid").kendoGrid({
            columns: [
                { field: "locationCode", title: "설비위치 코드" },
                { field: "locationName", title: "설비위치명" },
                { field: "upperLocation", title: "상위 설비위치" }
            ],
            height: 200,
            scrollable: true,
            sortable: true,
            selectable: true,
            dataSource: {
                data: [
                    { locationCode: "TEST001", locationName: "테스트위치1", upperLocation: "상위1" },
                    { locationCode: "TEST002", locationName: "테스트위치2", upperLocation: "상위2" }
                ]
            }
        });

        // 모달 외부 클릭 이벤트 방지
        $('.modal').on('click', function(e) {
            if ($(e.target).hasClass('modal')) {
                e.stopPropagation(); // 이벤트 전파 중지
                return false; // 기본 동작 방지
            }
        });

        // 기존 코드 유지
        $("#설비위치").kendoTextBox();
        
        $("#addButton").kendoButton({
            icon: "plus",
            themeColor: "primary",
            click: function(e) {
                e.preventDefault();
                $('.modal').fadeIn();
                if (page === null) {
                    page = new Page();
                }
                page.초기화();
            }
        });
    });

</script>

    {% endblock %}
