<div id="modalPmMaster" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h4>PM ë§ˆìŠ¤í„° ë“±ë¡</h4>
        </div>

        <div class="modal-body">
            <!-- ëŒ€ìƒì„¤ë¹„ ì„¹ì…˜ -->
            <div class="equipment-section">
                <div class="section-header">
                    <h5>
                        ëŒ€ìƒì„¤ë¹„
                        <i class="fas fa-info-circle tooltip-icon"
                           data-tooltip="PMëŒ€ìƒì´ ë˜ëŠ” ì„¤ë¹„ ë“±ë¡(í•˜ë‚˜ì˜ PMë‹¹ 1ê°œì˜ ì„¤ë¹„ë§Œ ë“±ë¡ ê°€ëŠ¥)"></i>
                    </h5>
                    <div class="button-group">
                        <button type="button" class="btn-equipment" id="selectEquipment" name="selectEquipment">
                            <i class="fas fa-search"></i> ì„¤ë¹„ì„ íƒ
                        </button>
                        <button type="button" class="btn-copy" id="copyPM" name="copyPM">
                            <i class="fas fa-copy"></i> PMë³µì‚¬
                        </button>
                    </div>
                </div>
                <div class="equipment-info">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì„¤ë¹„ì½”ë“œ</label>
                            <input type="text" class="form-control" id="equ_code" name="equ_code" readonly>
                        </div>
                        <div class="form-group">
                            <label>ì„¤ë¹„ëª…</label>
                            <input type="text" class="form-control" id="equ_name" name="equ_name" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì„¤ë¹„ìœ„ì¹˜</label>
                            <input type="hidden" id="equ_loc_pk" name="equ_loc_pk" />
                            <input type="text" class="form-control" id="equ_loc" name="equ_loc" readonly>
                        </div>
                        <div class="form-group">
                            <label>ì¤‘ìš”ë„</label>
                            <input type="text" class="form-control" id="equ_import" name="equ_import" readonly>
                        </div>
                        <div class="form-group">
                            <label>ì„¤ë¹„ìƒíƒœ</label>
                            <input type="text" class="form-control" id="equ_status" name="equ_status" readonly>
                        </div>
                        <div class="form-group">
                            <label>ë²•ì •ê´€ë¦¬ì„¤ë¹„</label>
                            <input type="text" class="form-control" id="equ_env_yn" name="equ_env_yn" readonly>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê³„íš ì„¹ì…˜ -->
            <div class="section">
                <div class="tab-group">
                    <button class="active">ê³„íš</button>
                    <button>ì‘ì—… ì¸ë ¥/ìì¬</button>
                    <button>PM WO ëª©ë¡</button>
                </div>                
                <div class="tab-content">
                    <!-- ê³„íš íƒ­ ì»¨í…ì¸  -->
                    <form id="pmMasterForm">
                        <input type="hidden" id="pm_pk" name="pm_pk">
                        <div class="plan-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>PM ë²ˆí˜¸ <span class="required">*</span></label>
                                    <input type="text" class="form-control" id="pmNumber" name="pmNumber" placeholder="PMë²ˆí˜¸ëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤" readonly>
                                </div>
                                <div class="form-group">
                                    <label>PMëª… <span class="required">*</span></label>
                                    <input type="text" class="form-control" id="pmName" name="pmName" placeholder="100ì ì´í•˜ë¡œ ì…ë ¥í•˜ì„¸ìš”">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>PMìœ í˜• <span class="required">*</span></label>
                                    <select class="form-control" id="pmType" name="pmType">
                                        <option value="">PMìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ì •ë¹„ì†Œìš”ì‹œê°„(ì‹œ)</label>
                                    <input type="number" class="form-control" id="maintenanceTime" name="maintenanceTime">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ì‹¤í–‰ë¶€ì„œ <span class="required">*</span></label>
                                    <select class="form-control" id="executionDept" name="executionDept">
                                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>PMë‹´ë‹¹ì <span class="required">*</span></label>
                                    <select class="form-control" id="pmManager" name="pmManager">
                                        <option value="">PMë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ì‘ì—…ì§€ì¹¨</label>
                                <textarea class="form-control" id="work_text" name="work_text" placeholder="2000ì ì´í•˜ë¡œ ì…ë ¥í•˜ì„¸ìš”" maxlength="2000"></textarea>
                                <div class="char-count">0 / 2000 bytes</div>
                            </div>
                        </div>
                    </form>
                    <!-- ì‘ì—… ì¸ë ¥/ìì¬ íƒ­ ì»¨í…ì¸  -->
                    <div id="pmWorkerMaterialContent" class="work-content" style="display: none;">
                        <div class="work-section">
                            <div class="section-header">
                                <h5>ì‘ì—…ë‹´ë‹¹ìì¤‘</h5>
                                <button class="btn btn-sm btn-primary" id="addWorker">ì‘í’ˆ ë“±ë¡</button>
                            </div>
                            <div class="grid">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ìˆœë²ˆ</th>
                                            <th>ì§ì¢… *</th>
                                            <th>ì˜ˆìƒì‘ì—…ì‹œê°„</th>
                                            <th>ì‚­ì œ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="no-data">
                                            <td colspan="4">ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="material-section">
                            <div class="section-header">
                                <h5>í•„ìš”ìì¬</h5>
                                <button class="btn btn-sm btn-primary" id="addMaterial">ìì¬ì„ íƒ</button>
                            </div>
                            <div class="grid">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ìì¬ì½”ë“œ</th>
                                            <th>ìì¬ëª…</th>
                                            <th>ì˜ˆìƒì†Œìš”ëŸ‰</th>
                                            <th>ìˆ˜ëŸ‰ë‹¨ìœ„</th>
                                            <th>ì‚­ì œ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="no-data">
                                            <td colspan="5">ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- PM WO ëª©ë¡ íƒ­ ì»¨í…ì¸  -->
                    <div id="pmWorkOrderContent" class="pmwo-content" style="display: none;">
                        <div class="grid">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>WOë²ˆí˜¸</th>
                                        <th>WOìƒì„±ì¼</th>
                                        <th>WOìƒíƒœ</th>
                                        <th>ì‘ì—…ê³„íšì¼</th>
                                        <th>ì‘ì—…ì™„ë£Œì¼</th>
                                        <th>ë‹´ë‹¹ì</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="no-data">
                                        <td colspan="6">ë°ì´í„° ì—†ìŒ</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="pagination">
                                <button class="prev-btn">&lt;</button>
                                <span class="page-number">1</span>
                                <button class="next-btn">&gt;</button>
                                <select class="page-size">
                                    <option value="30">30</option>
                                </select>
                                <span class="total-count">Total: 0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë²„íŠ¼ ì˜ì—­ -->
        <div class="modal-footer">
            <button type="button" class="btn btn-save" id="saveBtn">ì €ì¥</button>
            <button type="button" class="btn btn-close" id="closePmModal">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<style>
    /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal {
        background: none !important; /* âœ… ë°°ê²½ íë¦¼ íš¨ê³¼ ì œê±° */
        backdrop-filter: none !important; /* âœ… ë¸”ëŸ¬ íš¨ê³¼ ì œê±° */
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 9999;
    }

    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        width: 95%;
        max-width: 1400px;
        height: 800px;
        border-radius: 5px;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        padding: 20px;
    }

    .modal-header {
        background-color: #34495e;
        color: white;
        padding: 15px 20px;
        margin: -20px -20px 20px -20px;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .modal-header h4 {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

    .modal-body {
        flex: 1;
        overflow-y: auto;
        padding: 0 20px;
    }

    .modal-footer {
        padding: 15px 20px;
        text-align: right;
        border-top: 1px solid #dee2e6;
    }

    .section {
        background: #fff;
        margin-bottom: 20px;
        height: auto;
    }

    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
    }

    .form-group {
        flex: 1;
        min-width: 0;
        margin-bottom: 10px;
    }

        .form-group:first-child {
            flex: 0.8;
        }

        .form-group:last-child {
            flex: 1.2;
        }

        .form-group label {
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

    .form-control {
        font-size: 13px;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        transition: border-color 0.2s;
    }

        .form-control:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }

    .required {
        color: #e74c3c;
        margin-left: 3px;
    }

    .tabs {
        margin-bottom: 15px;
        border-bottom: 1px solid #ddd;
    }

    .tab {
        padding: 8px 15px;
        border: none;
        background: none;
        cursor: pointer;
    }

        .tab.active {
            border-bottom: 2px solid #007bff;
            color: #007bff;
        }

    textarea {
        min-height: 150px;
        resize: vertical;
    }

    .char-count {
        text-align: right;
        color: #666;
        font-size: 12px;
        margin-top: 3px;
        padding-right: 5px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .grid {
        width: 100%;
        margin-bottom: 20px;
    }

    .table {
        width: 100%;
        min-width: 800px;
        border-collapse: collapse;
    }

        .table th, .table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .table th {
            background-color: #f8f9fa;
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
        }

        .table td {
            font-size: 13px;
            color: #34495e;
        }

    .no-data td {
        text-align: center;
        padding: 20px;
        color: #666;
    }

    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        padding: 10px;
    }

    .page-size {
        margin-left: 10px;
    }

    .total-count {
        margin-left: 10px;
        color: #666;
    }

    /* í…ìŠ¤íŠ¸ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    textarea.form-control {
        width: 100%;
        height: 80px;
        min-height: 80px;
        padding: 8px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: none;
        font-size: 14px;
        line-height: 1.4;
    }

        /* í…ìŠ¤íŠ¸ ì˜ì—­ placeholder ìŠ¤íƒ€ì¼ */
        textarea.form-control::placeholder {
            color: #999;
        }

        /* í…ìŠ¤íŠ¸ ì˜ì—­ í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼ */
        textarea.form-control:focus {
            outline: none;
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }

    /* ëŒ€ìƒì„¤ë¹„ ì„¹ì…˜ ì „ìš© ìŠ¤íƒ€ì¼ */
    .equipment-section {
        background: #fff;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 20px;
    }

        /* ì²« ë²ˆì§¸ form-rowì˜ input ë„ˆë¹„ ì¡°ì • */
        .equipment-section .form-row:first-child .form-group {
            flex: 1;
        }

        /* ë‘ ë²ˆì§¸ form-rowì˜ input ë„ˆë¹„ ë™ì¼í•˜ê²Œ ì¡°ì • */
        .equipment-section .form-row:last-child .form-group {
            flex: 1;
        }

    /* íƒ­ ì»¨í…Œì´ë„ˆ */
    .tab-container {
        margin-top: 20px;
    }

    /* íƒ­ ì»¨í…ì¸  ì˜ì—­ */
    .tab-content {
        position: relative; /* ìœ„ì¹˜ ê³ ì • */
        min-height: 400px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
        width: 100%; /* ë„ˆë¹„ 100% */
    }

        .tab-content > .tab-pane {
            position: absolute; /* ì ˆëŒ€ ìœ„ì¹˜ */
            width: 100%; /* ë„ˆë¹„ 100% */
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        }

        .tab-content > .active {
            display: block; /* í™œì„±í™”ëœ íƒ­ë§Œ í‘œì‹œ */
            position: relative; /* í™œì„±í™”ëœ íƒ­ì€ ìƒëŒ€ ìœ„ì¹˜ë¡œ */
        }

    /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
    .section-title {
        position: relative;
        display: flex;
        align-items: center;
    }

        .section-title h4 {
            margin: 0;
            display: flex;
            align-items: center;
        }

    /* ëŠë‚Œí‘œ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
    .info-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        background: #e9ecef;
        border-radius: 50%;
        margin-left: 5px;
        cursor: help;
        position: relative;
    }

        .info-badge i {
            font-size: 12px;
            color: #666;
        }

    /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
    .tooltip {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 400px;
        background: #fff;
        border: 1px solid #ddd;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-radius: 4px;
        padding: 15px;
        z-index: 1000;
        margin-top: 10px;
    }

        .tooltip h5 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 14px;
        }

    .tooltip-content {
        font-size: 13px;
        line-height: 1.5;
    }

        .tooltip-content p {
            margin: 5px 0;
        }

        .tooltip-content .highlight {
            background-color: #e9ecef;
            padding: 2px 5px;
            border-radius: 3px;
        }

    /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ íˆ´íŒ í‘œì‹œ */
    .info-badge:hover .tooltip {
        display: block;
    }

    /* íˆ´íŒ í™”ì‚´í‘œ */
    .tooltip:before {
        content: '';
        position: absolute;
        top: -6px;
        left: 10px;
        width: 10px;
        height: 10px;
        background: #fff;
        border-left: 1px solid #ddd;
        border-top: 1px solid #ddd;
        transform: rotate(45deg);
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .modal-footer .btn {
        padding: 6px 20px;
        font-size: 13px;
        margin-left: 10px;
    }

    .btn-save {
        background-color: white;
        border: 1px solid #0d6efd;
        color: #0d6efd;
    }

        .btn-save:hover {
            background-color: #0d6efd;
            color: white;
        }

    .btn-close {
        background-color: white;
        border: 1px solid #6c757d;
        color: #6c757d;
    }

        .btn-close:hover {
            background-color: #6c757d;
            color: white;
        }

    /* íˆ´íŒ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
    .tooltip-icon {
        color: #6c757d;
        font-size: 14px;
        margin-left: 5px;
        cursor: help;
        position: relative;
    }

        /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
        .tooltip-icon[data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: 100%;
            width: max-content;
            max-width: 300px;
            padding: 8px 12px;
            border-radius: 4px;
            background-color: #2c3e50;
            color: white;
            font-size: 12px;
            font-weight: normal;
            z-index: 1000;
            white-space: nowrap;
        }

        /* íˆ´íŒ í™”ì‚´í‘œ */
        .tooltip-icon[data-tooltip]:hover::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: 100%;
            border: 6px solid transparent;
            border-top-color: #2c3e50;
            margin-bottom: -12px;
        }

    /* ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
    .button-group {
        display: flex;
        gap: 4px;
    }

    /* ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .btn {
        padding: 6px 12px;
        font-size: 13px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        border-radius: 4px;
        transition: all 0.2s ease-in-out;
    }

    /* ì„¤ë¹„ì„ íƒ, PMë³µì‚¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-equipment, .btn-copy {
        background: #1e4f88 !important;
        color: white !important;
        border: none !important;
    }

        .btn-equipment:hover, .btn-copy:hover {
            background-color: #2980b9;
        }

    /* ì‘ì—… ë“±ë¡, ìì¬ì„ íƒ, ì €ì¥, ë‹«ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-primary, .btn-save, .btn-close, #addWorker, #addMaterial {
        background-color: #3498db;
        border: none;
        color: white;
    }

        .btn-primary:hover, .btn-save:hover, .btn-close:hover, #addWorker:hover, #addMaterial:hover {
            background-color: #2980b9;
        }

    /* ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
    .button-group {
        display: flex;
        gap: 4px;
    }

    /* ëª¨ë‹¬ í‘¸í„° ìŠ¤íƒ€ì¼ */
    .modal-footer {
        padding: 15px 20px;
        text-align: right;
        border-top: 1px solid #dee2e6;
    }

        .modal-footer .btn {
            margin-left: 10px;
        }

    /* ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
    .btn i {
        font-size: 12px;
    }

    /* íƒ­ ìŠ¤íƒ€ì¼ */
    .nav-tabs {
        border-bottom: none;
    }

        .nav-tabs .nav-item .nav-link {
            border: none;
            padding: 8px 16px;
            color: #666;
            background-color: transparent;
        }

            .nav-tabs .nav-item .nav-link.active {
                background-color: transparent;
                color: #666;
                border-radius: 0;
            }

            /* ë¹„í™œì„± íƒ­ ìŠ¤íƒ€ì¼ */
            .nav-tabs .nav-item .nav-link:not(.active) {
                background-color: transparent;
            }

    /* íƒ­ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .tab-group {
        display: flex;
        margin-bottom: 10px;
        border-bottom: 1px solid #1e4f88; /* ë„¤ì´ë¹„ ì»¬ëŸ¬ ë°‘ì¤„ */
    }

        .tab-group button {
            padding: 6px 20px;
            border: 1px solid #ccc;
            background: #f5f5f5;
            margin-right: -1px;
            cursor: pointer;
            font-size: 12px;
        }

            .tab-group button.active {
                background: #1e4f88; /* ë„¤ì´ë¹„ ë°°ê²½ìƒ‰ */
                color: white;
                border-color: #1e4f88;
                position: relative;
            }

            /* ë§ˆì§€ë§‰ íƒ­ ì˜¤ë¥¸ìª½ ì—¬ë°± ì œê±° */
            .tab-group button:last-child {
                margin-right: 0;
            }

    #modalPmMaster {
        z-index: 1000 !important; /* âœ… ë¶€ëª¨ ëª¨ë‹¬ì˜ z-index */
    }

    #pmMasterTabs {
        margin-bottom: 20px;
    }

    #pmMasterTabs button {
        padding: 10px 20px;
        margin-right: 5px;
        border: 1px solid #ddd;
        background: #f5f5f5;
        cursor: pointer;
    }

    #pmMasterTabs button.active {
        background: #007bff;
        color: white;
        border-color: #0056b3;
    }

    #pmMasterTabs button:hover {
        background: #e9ecef;
    }

    #pmMasterTabs button.active:hover {
        background: #0056b3;
    }
</style>

<script type="text/javascript">
    let pmMasterPage = null;
    class PmMaster {
        constructor() {
            this.grid = null;
            this.baseUrl = '/api/kmms/pm_master';

            this.resetForm = this.resetForm.bind(this);
            this.init();
        }

        init() {      
            let _this = this;
            const modal = $("#modalPmMaster");

            AjaxUtil.fillDropDownOptions($('#pmType'), 'user_code', 'choose', null, 'PM_TYPE');
            
            $("#executionDept").kendoDropDownTree({
                dataSource: {
                    transport: {
                        read: {
                            url: "/api/system/depart?action=depart_tree",
                            type: "GET",
                            dataType: "json"
                        }
                    },
                    //ì„œë²„ì—ì„œ ë°›ì€ JSON ë°ì´í„°ë¥¼ ê°€ê³µí•˜ëŠ” ì—­í• 
                    schema: {
                        data: function (response) {
                            console.log("ğŸ“Œ [DEBUG] API ì‘ë‹µ ë°ì´í„°:", response);
                            return response.items || [];  // âœ… 'items' ì•ˆì˜ ë°ì´í„°ë§Œ ë°˜í™˜
                        },
                        model: {
                            id: "id",
                            text: "text",
                            children: "items"  // âœ… DropDownTreeê°€ itemsë¥¼ í•˜ìœ„ í•­ëª©ìœ¼ë¡œ ì¸ì‹
                        }
                    }
                },
                dataTextField: "text",
                dataValueField: "id",
                placeholder: "ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”",
                height: 400
            });
            AjaxUtil.fillDropDownOptions($('#pmManager'), 'auth_user', 'choose', null);            

            $('#selectEquipment').kendoButton({
                themeColor: "base",
                icon: "k-i-plus", // ê¸°ì–´ ì•„ì´ì½˜ (ì„¤ë¹„ ê´€ë ¨)
                click: function (e) {
                    e.preventDefault();
                    $("#modalEqu").fadeIn();
                }
            });

            $("#copyPM").kendoButton({
                icon: "k-i-copy",// ë³µì‚¬ ì•„ì´ì½˜
                click: function (e) {
                    e.preventDefault();
                    $("#modalPmCopy").fadeIn();
                }
            });

            // ESC í‚¤ ëˆ„ë¥¼ ë•Œ ëª¨ë‹¬ ë‹«ê¸°
            $(document).on('keydown', (e) => {
                if (e.keyCode === 27) { // ESC key
                    modal.fadeOut();
                }
            });

            $("#saveBtn").kendoButton({
                icon: "k-i-save",
                click: function (e) {
                    e.preventDefault();
                    _this.saveData();
                }
            });

            // ëª¨ë‹¬ ë‹«ê¸° - ë‹«ê¸° ë²„íŠ¼ í´ë¦­
            $('#closePmModal').kendoButton({
                click: function (e) {
                    e.preventDefault();
                    modal.fadeOut();
                }
            });
        }       

        saveData() {            
            let _this = this;
            let data = FormUtil.extractForm($('#pmMasterForm'));
            data.pm_type = $("#pmType").data("kendoDropDown").value();  // pmType ê°’ ëª…ì‹œì  ì¶”ê°€
            data.dept_id = $("#executionDept").data("kendoDropDownTree").value();
            data.pmManager = $("#pmManager").data("kendoDropDown").value();
            data.equ_id = $("#equ_loc_pk").val();
            
  
            let Name = $('#pmName').val();
            if (!Name) {
                Alert.alert('', 'PMëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            let funcSucc = function (resp) {
                if (resp.success) {                    
                    Notify.success('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    _this.resetData();

                    // ë¶€ëª¨ í˜ì´ì§€ì˜ ê·¸ë¦¬ë“œ ê°±ì‹ 
                    page.searchMainData();

                } else {
                    Alert.alert('error', resp.message);
                }
            };
            
            AjaxUtil.postAsyncData(_this.baseUrl + '?action=save', data, funcSucc);
            $("#modalPmMaster").fadeOut();
        }

        resetData() {
            let _this = this;
            FormUtil.resetForm($('#pmMasterForm'));
        }

        searchLocationData() {
            let _this = this;

            let param = {
                action: 'read',
            };

            let result = AjaxUtil.getSyncData(_this.baseUrl, param);
            _this.grid.setData(result);
        }

        resetForm() {

        }
    }

    pmMasterPage = new PmMaster();
    $(document).ready(function () {
        // íƒ­ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        $('.tab-group button').on('click', function () {
            // ëª¨ë“  íƒ­ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            $('.tab-group button').removeClass('active');
            // í´ë¦­ëœ íƒ­ì— active í´ë˜ìŠ¤ ì¶”ê°€
            $(this).addClass('active');

            // ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
            $('#pmMasterForm, #pmWorkerMaterialContent, #pmWorkOrderContent').hide();

            // íƒ­ ë‚´ìš© ì „í™˜
            var tabName = $(this).text().trim();
            switch(tabName) {
                case 'ê³„íš':
                    $('#pmMasterForm').show();
                    break;
                case 'ì‘ì—… ì¸ë ¥/ìì¬':
                    $('#pmWorkerMaterialContent').show();
                    break;
                case 'PM WO ëª©ë¡':
                    $('#pmWorkOrderContent').show();
                    break;
            }
        });

        // ì´ˆê¸° ìƒíƒœ: ê³„íš íƒ­ í™œì„±í™”
        $('.tab-group button:first').click();

        // ê¸€ììˆ˜ ì¹´ìš´íŠ¸ ê¸°ëŠ¥
        $('#work_text').on('input', function () {
            const maxLength = 4000;
            const currentLength = $(this).val().length;
            $('.char-count').text(`${currentLength} / ${maxLength} bytes`);

            // ìµœëŒ€ ê¸€ììˆ˜ ì²´í¬
            if (currentLength > maxLength) {
                $(this).val($(this).val().substring(0, maxLength));
            }
        });
    });
</script>